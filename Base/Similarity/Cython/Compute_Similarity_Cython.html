<!DOCTYPE html>
<!-- Generated by Cython 0.29.14 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: Compute_Similarity_Cython.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.14</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="Compute_Similarity_Cython.c">Compute_Similarity_Cython.c</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: #cython: boundscheck=False</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: #cython: wraparound=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: #cython: initializedcheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">004</span>: #cython: language_level=3</pre>
<pre class="cython line score-0">&#xA0;<span class="">005</span>: #cython: nonecheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">006</span>: #cython: cdivision=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">007</span>: #cython: unpack_method_calls=True</pre>
<pre class="cython line score-0">&#xA0;<span class="">008</span>: #cython: overflowcheck=False</pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">010</span>: """ Created on 23/10/17     @author: Maurizio Ferrari Dacrema """</pre>
<pre class="cython line score-0">&#xA0;<span class="">011</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: A compile time, the Determine the operative system. The interface of numpy returns a different type for argsort under</pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: windows and linux.</pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: http://docs.cython.org/en/latest/src/userguide/language_basics.html#conditional-compilation</pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: """</pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: IF UNAME_SYSNAME == "linux":</pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>:     DEF LONG_t = "long"</pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: ELIF  UNAME_SYSNAME == "Windows":</pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>:     DEF LONG_t = "long long"</pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: ELSE:</pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>:     DEF LONG_t = "long long"</pre>
<pre class="cython line score-0">&#xA0;<span class="">024</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">025</span>: import time, sys</pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_time, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_time, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_sys, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sys, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 25, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">026</span>: import cython</pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">027</span>: import numpy as np</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 27, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_np, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 27, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">028</span>: cimport numpy as np</pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: from cpython.array cimport array, clone</pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">032</span>: from libc.math cimport sqrt</pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">033</span>: import scipy.sparse as sps</pre>
<pre class='cython code score-16 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s__27);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s__27);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s__27);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_scipy_sparse, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_sps, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 33, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">034</span>: from Base.Recommender_utils import check_matrix</pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_check_matrix);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_check_matrix);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_2, 0, __pyx_n_s_check_matrix);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_Base_Recommender_utils, __pyx_t_2, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_1, __pyx_n_s_check_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_check_matrix, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 34, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: @cython.boundscheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: @cython.wraparound(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: @cython.initializedcheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">039</span>: @cython.nonecheck(False)</pre>
<pre class="cython line score-0">&#xA0;<span class="">040</span>: @cython.cdivision(True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">041</span>: @cython.overflowcheck(False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">042</span>: cdef class Compute_Similarity_Cython:</pre>
<pre class='cython code score-0 '>struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython {
  PyObject_HEAD
  struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_vtab;
  int TopK;
  long n_columns;
  long n_rows;
  __Pyx_memviewslice this_item_weights;
  __Pyx_memviewslice this_item_weights_mask;
  __Pyx_memviewslice this_item_weights_id;
  int this_item_weights_counter;
  __Pyx_memviewslice user_to_item_row_ptr;
  __Pyx_memviewslice user_to_item_cols;
  __Pyx_memviewslice item_to_user_rows;
  __Pyx_memviewslice item_to_user_col_ptr;
  __Pyx_memviewslice user_to_item_data;
  __Pyx_memviewslice item_to_user_data;
  __Pyx_memviewslice sumOfSquared;
  __Pyx_memviewslice sumOfSquared_to_1_minus_alpha;
  __Pyx_memviewslice sumOfSquared_to_alpha;
  int shrink;
  int normalize;
  int adjusted_cosine;
  int pearson_correlation;
  int tanimoto_coefficient;
  int asymmetric_cosine;
  int dice_coefficient;
  int tversky_coefficient;
  float asymmetric_alpha;
  float tversky_alpha;
  float tversky_beta;
  int use_row_weights;
  __Pyx_memviewslice row_weights;
  __Pyx_memviewslice W_dense;
};
/* … */
struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython {
  PyObject *(*useOnlyBooleanInteractions)(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *, PyObject *);
  PyObject *(*applyPearsonCorrelation)(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *, PyObject *);
  PyObject *(*applyAdjustedCosine)(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *, PyObject *);
  __Pyx_memviewslice (*getUsersThatRatedItem)(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *, long);
  __Pyx_memviewslice (*getItemsRatedByUser)(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *, long);
  PyObject *(*computeItemSimilarities)(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *, long);
};
static struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_vtabptr_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython;

</pre><pre class="cython line score-0">&#xA0;<span class="">043</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>:     cdef int TopK</pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>:     cdef long n_columns, n_rows</pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>:     cdef double[:] this_item_weights</pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>:     cdef int[:] this_item_weights_mask, this_item_weights_id</pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>:     cdef int this_item_weights_counter</pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>:     cdef int[:] user_to_item_row_ptr, user_to_item_cols</pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>:     cdef int[:] item_to_user_rows, item_to_user_col_ptr</pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>:     cdef double[:] user_to_item_data, item_to_user_data</pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>:     cdef double[:] sumOfSquared, sumOfSquared_to_1_minus_alpha, sumOfSquared_to_alpha</pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>:     cdef int shrink, normalize, adjusted_cosine, pearson_correlation, tanimoto_coefficient, asymmetric_cosine, dice_coefficient, tversky_coefficient</pre>
<pre class="cython line score-0">&#xA0;<span class="">056</span>:     cdef float asymmetric_alpha, tversky_alpha, tversky_beta</pre>
<pre class="cython line score-0">&#xA0;<span class="">057</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">058</span>:     cdef int use_row_weights</pre>
<pre class="cython line score-0">&#xA0;<span class="">059</span>:     cdef double[:] row_weights</pre>
<pre class="cython line score-0">&#xA0;<span class="">060</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">061</span>:     cdef double[:,:] W_dense</pre>
<pre class="cython line score-0">&#xA0;<span class="">062</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">063</span>:     def __init__(self, dataMatrix, topK = 100, shrink=0, normalize = True,</pre>
<pre class='cython code score-10 '>/* Python wrapper */
static int __pyx_pw_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython___init__[] = "\n        Computes the cosine similarity on the columns of dataMatrix\n        If it is computed on URM=|users|x|items|, pass the URM as is.\n        If it is computed on ICM=|items|x|features|, pass the ICM transposed.\n        :param dataMatrix:\n        :param topK:\n        :param shrink:\n        :param normalize:           If True divide the dot product by the product of the norms\n        :param row_weights:         Multiply the values in each row by a specified value. Array\n        :param asymmetric_alpha     Coefficient alpha for the asymmetric cosine\n        :param similarity:  \"cosine\"        computes Cosine similarity\n                            \"adjusted\"      computes Adjusted Cosine, removing the average of the users\n                            \"asymmetric\"    computes Asymmetric Cosine\n                            \"pearson\"       computes Pearson Correlation, removing the average of the items\n                            \"jaccard\"       computes Jaccard similarity for binary interactions using Tanimoto\n                            \"dice\"          computes Dice similarity for binary interactions\n                            \"tversky\"       computes Tversky similarity for binary interactions\n                            \"tanimoto\"      computes Tanimoto coefficient for binary interactions\n\n        ";
#if CYTHON_COMPILING_IN_CPYTHON
struct wrapperbase __pyx_wrapperbase_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython___init__;
#endif
static int __pyx_pw_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_dataMatrix = 0;
  PyObject *__pyx_v_topK = 0;
  PyObject *__pyx_v_shrink = 0;
  PyObject *__pyx_v_normalize = 0;
  PyObject *__pyx_v_asymmetric_alpha = 0;
  PyObject *__pyx_v_tversky_alpha = 0;
  PyObject *__pyx_v_tversky_beta = 0;
  PyObject *__pyx_v_similarity = 0;
  PyObject *__pyx_v_row_weights = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_dataMatrix,&amp;__pyx_n_s_topK,&amp;__pyx_n_s_shrink,&amp;__pyx_n_s_normalize,&amp;__pyx_n_s_asymmetric_alpha,&amp;__pyx_n_s_tversky_alpha,&amp;__pyx_n_s_tversky_beta,&amp;__pyx_n_s_similarity,&amp;__pyx_n_s_row_weights,0};
    PyObject* values[9] = {0,0,0,0,0,0,0,0,0};
    values[1] = ((PyObject *)__pyx_int_100);
    values[2] = ((PyObject *)__pyx_int_0);
    values[3] = ((PyObject *)Py_True);
    values[4] = ((PyObject *)__pyx_float_0_5);
    values[5] = ((PyObject *)__pyx_float_1_0);
    values[6] = ((PyObject *)__pyx_float_1_0);
    values[7] = ((PyObject *)__pyx_n_u_cosine);
/* … */
  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython___init__(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, PyObject *__pyx_v_dataMatrix, PyObject *__pyx_v_topK, PyObject *__pyx_v_shrink, PyObject *__pyx_v_normalize, PyObject *__pyx_v_asymmetric_alpha, PyObject *__pyx_v_tversky_alpha, PyObject *__pyx_v_tversky_beta, PyObject *__pyx_v_similarity, PyObject *__pyx_v_row_weights) {
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_11, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_12, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_15, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dataMatrix);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">064</span>:                  asymmetric_alpha = 0.5, tversky_alpha = 1.0, tversky_beta = 1.0,</pre>
<pre class="cython line score-50" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">065</span>:                  similarity = "cosine", row_weights = None):</pre>
<pre class='cython code score-50 '>    values[8] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_dataMatrix)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_topK);
          if (value) { values[1] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_shrink);
          if (value) { values[2] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_normalize);
          if (value) { values[3] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  4:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_asymmetric_alpha);
          if (value) { values[4] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  5:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_tversky_alpha);
          if (value) { values[5] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  6:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_tversky_beta);
          if (value) { values[6] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  7:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_similarity);
          if (value) { values[7] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  8:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_row_weights);
          if (value) { values[8] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 63, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  9: values[8] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 8);
        CYTHON_FALLTHROUGH;
        case  8: values[7] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 7);
        CYTHON_FALLTHROUGH;
        case  7: values[6] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 6);
        CYTHON_FALLTHROUGH;
        case  6: values[5] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 5);
        CYTHON_FALLTHROUGH;
        case  5: values[4] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 4);
        CYTHON_FALLTHROUGH;
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_dataMatrix = values[0];
    __pyx_v_topK = values[1];
    __pyx_v_shrink = values[2];
    __pyx_v_normalize = values[3];
    __pyx_v_asymmetric_alpha = values[4];
    __pyx_v_tversky_alpha = values[5];
    __pyx_v_tversky_beta = values[6];
    __pyx_v_similarity = values[7];
    __pyx_v_row_weights = values[8];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 0, 1, 9, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 63, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython___init__(((struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self), __pyx_v_dataMatrix, __pyx_v_topK, __pyx_v_shrink, __pyx_v_normalize, __pyx_v_asymmetric_alpha, __pyx_v_tversky_alpha, __pyx_v_tversky_beta, __pyx_v_similarity, __pyx_v_row_weights);
</pre><pre class="cython line score-0">&#xA0;<span class="">066</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">067</span>:         Computes the cosine similarity on the columns of dataMatrix</pre>
<pre class="cython line score-0">&#xA0;<span class="">068</span>:         If it is computed on URM=|users|x|items|, pass the URM as is.</pre>
<pre class="cython line score-0">&#xA0;<span class="">069</span>:         If it is computed on ICM=|items|x|features|, pass the ICM transposed.</pre>
<pre class="cython line score-0">&#xA0;<span class="">070</span>:         :param dataMatrix:</pre>
<pre class="cython line score-0">&#xA0;<span class="">071</span>:         :param topK:</pre>
<pre class="cython line score-0">&#xA0;<span class="">072</span>:         :param shrink:</pre>
<pre class="cython line score-0">&#xA0;<span class="">073</span>:         :param normalize:           If True divide the dot product by the product of the norms</pre>
<pre class="cython line score-0">&#xA0;<span class="">074</span>:         :param row_weights:         Multiply the values in each row by a specified value. Array</pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:         :param asymmetric_alpha     Coefficient alpha for the asymmetric cosine</pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:         :param similarity:  "cosine"        computes Cosine similarity</pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:                             "adjusted"      computes Adjusted Cosine, removing the average of the users</pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:                             "asymmetric"    computes Asymmetric Cosine</pre>
<pre class="cython line score-0">&#xA0;<span class="">079</span>:                             "pearson"       computes Pearson Correlation, removing the average of the items</pre>
<pre class="cython line score-0">&#xA0;<span class="">080</span>:                             "jaccard"       computes Jaccard similarity for binary interactions using Tanimoto</pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>:                             "dice"          computes Dice similarity for binary interactions</pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:                             "tversky"       computes Tversky similarity for binary interactions</pre>
<pre class="cython line score-0">&#xA0;<span class="">083</span>:                             "tanimoto"      computes Tanimoto coefficient for binary interactions</pre>
<pre class="cython line score-0">&#xA0;<span class="">084</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">085</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">086</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">087</span>:         Asymmetric Cosine as described in:</pre>
<pre class="cython line score-0">&#xA0;<span class="">088</span>:         Aiolli, F. (2013, October). Efficient top-n recommendation for very large scale binary rated datasets. In Proceedings of the 7th ACM conference on Recommender systems (pp. 273-280). ACM.</pre>
<pre class="cython line score-0">&#xA0;<span class="">089</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">090</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">091</span>: </pre>
<pre class="cython line score-32" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:         super(Compute_Similarity_Cython, self).__init__()</pre>
<pre class='cython code score-32 '>  __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_ptype_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_ptype_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, ((PyObject *)__pyx_ptype_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython));
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_self));
  <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_self));
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 1, ((PyObject *)__pyx_v_self));
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_builtin_super, __pyx_t_2, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_init);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">093</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:         self.n_columns = dataMatrix.shape[1]</pre>
<pre class='cython code score-13 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, 1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_4 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 94, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_self-&gt;n_columns = __pyx_t_4;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:         self.n_rows = dataMatrix.shape[0]</pre>
<pre class='cython code score-13 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 95, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 95, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_1); if (unlikely((__pyx_t_4 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 95, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self-&gt;n_rows = __pyx_t_4;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:         self.shrink = shrink</pre>
<pre class='cython code score-7 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_shrink); if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L1_error)</span>
  __pyx_v_self-&gt;shrink = __pyx_t_5;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:         self.normalize = normalize</pre>
<pre class='cython code score-7 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_normalize); if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 97, __pyx_L1_error)</span>
  __pyx_v_self-&gt;normalize = __pyx_t_5;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">098</span>:         self.asymmetric_alpha = asymmetric_alpha</pre>
<pre class='cython code score-10 '>  __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_asymmetric_alpha); if (unlikely((__pyx_t_6 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 98, __pyx_L1_error)</span>
  __pyx_v_self-&gt;asymmetric_alpha = __pyx_t_6;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:         self.tversky_alpha = tversky_alpha</pre>
<pre class='cython code score-10 '>  __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_tversky_alpha); if (unlikely((__pyx_t_6 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L1_error)</span>
  __pyx_v_self-&gt;tversky_alpha = __pyx_t_6;
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">100</span>:         self.tversky_beta = tversky_beta</pre>
<pre class='cython code score-10 '>  __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_v_tversky_beta); if (unlikely((__pyx_t_6 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 100, __pyx_L1_error)</span>
  __pyx_v_self-&gt;tversky_beta = __pyx_t_6;
</pre><pre class="cython line score-0">&#xA0;<span class="">101</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">102</span>:         self.adjusted_cosine = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;adjusted_cosine = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">103</span>:         self.asymmetric_cosine = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;asymmetric_cosine = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">104</span>:         self.pearson_correlation = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;pearson_correlation = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">105</span>:         self.tanimoto_coefficient = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;tanimoto_coefficient = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">106</span>:         self.dice_coefficient = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;dice_coefficient = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:         self.tversky_coefficient = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;tversky_coefficient = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">108</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">109</span>:         if similarity == "adjusted":</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_adjusted, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 109, __pyx_L1_error)</span>
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">110</span>:             self.adjusted_cosine = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;adjusted_cosine = 1;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">111</span>:         elif similarity == "asymmetric":</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_asymmetric, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 111, __pyx_L1_error)</span>
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">112</span>:             self.asymmetric_cosine = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;asymmetric_cosine = 1;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">113</span>:         elif similarity == "pearson":</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_pearson, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 113, __pyx_L1_error)</span>
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">114</span>:             self.pearson_correlation = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;pearson_correlation = 1;
</pre><pre class="cython line score-4" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">115</span>:         elif similarity == "jaccard" or similarity == "tanimoto":</pre>
<pre class='cython code score-4 '>  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_jaccard, Py_EQ)); if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_8 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_tanimoto, Py_EQ)); if (unlikely(__pyx_t_8 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 115, __pyx_L1_error)</span>
  __pyx_t_7 = __pyx_t_8;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">116</span>:             self.tanimoto_coefficient = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;tanimoto_coefficient = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">117</span>:             # Tanimoto has a specific kind of normalization</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>:             self.normalize = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;normalize = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">119</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">120</span>:         elif similarity == "dice":</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_dice, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>:             self.dice_coefficient = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;dice_coefficient = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">122</span>:             self.normalize = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;normalize = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">123</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">124</span>:         elif similarity == "tversky":</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_tversky, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 124, __pyx_L1_error)</span>
  if (__pyx_t_7) {
/* … */
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">125</span>:             self.tversky_coefficient = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;tversky_coefficient = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">126</span>:             self.normalize = False</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;normalize = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">127</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">128</span>:         elif similarity == "cosine":</pre>
<pre class='cython code score-2 '>  __pyx_t_7 = (<span class='pyx_c_api'>__Pyx_PyUnicode_Equals</span>(__pyx_v_similarity, __pyx_n_u_cosine, Py_EQ)); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 128, __pyx_L1_error)</span>
  if (likely(__pyx_t_7)) {
    goto __pyx_L3;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">129</span>:             pass</pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:         else:</pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">131</span>:             raise ValueError("Cosine_Similarity: value for parameter 'mode' not recognized."</pre>
<pre class='cython code score-6 '>  /*else*/ {
/* … */
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 131, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='error_goto'>__PYX_ERR(0, 131, __pyx_L1_error)</span>
  }
  __pyx_L3:;
</pre><pre class="cython line score-0">&#xA0;<span class="">132</span>:                              " Allowed values are: 'cosine', 'pearson', 'adjusted', 'asymmetric', 'jaccard', 'tanimoto',"</pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>:                              "dice, tversky."</pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:                              " Passed value was '{}'".format(similarity))</pre>
<pre class='cython code score-16 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_Cosine_Similarity_value_for_para, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 134, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      }
    }
    __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_3, __pyx_v_similarity) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_v_similarity);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 134, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">135</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">136</span>: </pre>
<pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:         self.TopK = min(topK, self.n_columns)</pre>
<pre class='cython code score-24 '>  __pyx_t_4 = __pyx_v_self-&gt;n_columns;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_topK);
  __pyx_t_2 = __pyx_v_topK;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_9 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_3, __pyx_t_2, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_9); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 137, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (__pyx_t_7) {
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 137, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    __pyx_t_1 = __pyx_t_9;
    __pyx_t_9 = 0;
  } else {
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    __pyx_t_1 = __pyx_t_2;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_1); if (unlikely((__pyx_t_5 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 137, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_self-&gt;TopK = __pyx_t_5;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">138</span>:         self.this_item_weights = np.zeros(self.n_columns, dtype=np.float64)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_9, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_10, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 138, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;this_item_weights, 0);
  __pyx_v_self-&gt;this_item_weights = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:         self.this_item_weights_id = np.zeros(self.n_columns, dtype=np.int32)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int32);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_10, __pyx_n_s_dtype, __pyx_t_3) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_9, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_3, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 139, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;this_item_weights_id, 0);
  __pyx_v_self-&gt;this_item_weights_id = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:         self.this_item_weights_mask = np.zeros(self.n_columns, dtype=np.int32)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_3);
  __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_int32);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_9, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 140, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;this_item_weights_mask, 0);
  __pyx_v_self-&gt;this_item_weights_mask = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:         self.this_item_weights_counter = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;this_item_weights_counter = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">143</span>:         # Copy data to avoid altering the original object</pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:         dataMatrix = dataMatrix.copy()</pre>
<pre class='cython code score-19 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_copy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_9 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_2 = (__pyx_t_9) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">145</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">149</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:         if self.adjusted_cosine:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_self-&gt;adjusted_cosine != 0);
  if (__pyx_t_7) {
/* … */
    goto __pyx_L6;
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>:             dataMatrix = self.applyAdjustedCosine(dataMatrix)</pre>
<pre class='cython code score-1 '>    __pyx_t_2 = ((struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self-&gt;__pyx_vtab)-&gt;applyAdjustedCosine(__pyx_v_self, __pyx_v_dataMatrix);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">152</span>:         elif self.pearson_correlation:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = (__pyx_v_self-&gt;pearson_correlation != 0);
  if (__pyx_t_7) {
/* … */
    goto __pyx_L6;
  }
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">153</span>:             dataMatrix = self.applyPearsonCorrelation(dataMatrix)</pre>
<pre class='cython code score-1 '>    __pyx_t_2 = ((struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self-&gt;__pyx_vtab)-&gt;applyPearsonCorrelation(__pyx_v_self, __pyx_v_dataMatrix);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 153, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:         elif self.tanimoto_coefficient or self.dice_coefficient or self.tversky_coefficient:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_self-&gt;tanimoto_coefficient != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_8 = (__pyx_v_self-&gt;dice_coefficient != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L7_bool_binop_done;
  }
  __pyx_t_8 = (__pyx_v_self-&gt;tversky_coefficient != 0);
  __pyx_t_7 = __pyx_t_8;
  __pyx_L7_bool_binop_done:;
  if (__pyx_t_7) {
/* … */
  }
  __pyx_L6:;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>:             dataMatrix = self.useOnlyBooleanInteractions(dataMatrix)</pre>
<pre class='cython code score-1 '>    __pyx_t_2 = ((struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self-&gt;__pyx_vtab)-&gt;useOnlyBooleanInteractions(__pyx_v_self, __pyx_v_dataMatrix);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 155, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">156</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">157</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">158</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">159</span>:         # Compute sum of squared values to be used in normalization</pre>
<pre class="cython line score-81" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">160</span>:         self.sumOfSquared = np.array(dataMatrix.power(2).sum(axis=0), dtype=np.float64).ravel()</pre>
<pre class='cython code score-81 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_power);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_1 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_1)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
    }
  }
  __pyx_t_3 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_10, __pyx_t_1, __pyx_int_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_10, __pyx_int_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_axis, __pyx_int_0) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_empty_tuple, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_13) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_ravel);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  __pyx_t_13 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_13)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_2 = (__pyx_t_13) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_13) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 160, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;sumOfSquared, 0);
  __pyx_v_self-&gt;sumOfSquared = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">161</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">162</span>:         # Tanimoto does not require the square root to be applied</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:         if not (self.tanimoto_coefficient or self.dice_coefficient or self.tversky_coefficient):</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_self-&gt;tanimoto_coefficient != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L11_bool_binop_done;
  }
  __pyx_t_8 = (__pyx_v_self-&gt;dice_coefficient != 0);
  if (!__pyx_t_8) {
  } else {
    __pyx_t_7 = __pyx_t_8;
    goto __pyx_L11_bool_binop_done;
  }
  __pyx_t_8 = (__pyx_v_self-&gt;tversky_coefficient != 0);
  __pyx_t_7 = __pyx_t_8;
  __pyx_L11_bool_binop_done:;
  __pyx_t_8 = ((!__pyx_t_7) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">164</span>:             self.sumOfSquared = np.sqrt(self.sumOfSquared)</pre>
<pre class='cython code score-23 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 164, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_sqrt);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 164, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self-&gt;sumOfSquared, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 164, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
      __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
      if (likely(__pyx_t_3)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      }
    }
    __pyx_t_2 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_3, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 164, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 164, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;sumOfSquared, 0);
    __pyx_v_self-&gt;sumOfSquared = __pyx_t_11;
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">165</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:         if self.asymmetric_cosine:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_self-&gt;asymmetric_cosine != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-52" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">167</span>:             self.sumOfSquared_to_1_minus_alpha = np.power(self.sumOfSquared, 2 * (1 - self.asymmetric_alpha))</pre>
<pre class='cython code score-52 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_13, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_13, __pyx_n_s_power);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_13 = __pyx_memoryview_fromslice(__pyx_v_self-&gt;sumOfSquared, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((2.0 * (1.0 - __pyx_v_self-&gt;asymmetric_alpha)));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_9 = NULL;
    __pyx_t_5 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
      __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
      if (likely(__pyx_t_9)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
        __pyx_t_5 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_13, __pyx_t_3};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_1)) {
      PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_t_13, __pyx_t_3};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_1, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_10 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      if (__pyx_t_9) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0, __pyx_t_9); __pyx_t_9 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 0+__pyx_t_5, __pyx_t_13);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_10, 1+__pyx_t_5, __pyx_t_3);
      __pyx_t_13 = 0;
      __pyx_t_3 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_10, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 167, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;sumOfSquared_to_1_minus_alpha, 0);
    __pyx_v_self-&gt;sumOfSquared_to_1_minus_alpha = __pyx_t_11;
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
</pre><pre class="cython line score-52" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">168</span>:             self.sumOfSquared_to_alpha = np.power(self.sumOfSquared, 2 * self.asymmetric_alpha)</pre>
<pre class='cython code score-52 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_power);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_self-&gt;sumOfSquared, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='py_c_api'>PyFloat_FromDouble</span>((2.0 * __pyx_v_self-&gt;asymmetric_alpha));<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_13 = NULL;
    __pyx_t_5 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
      __pyx_t_13 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
      if (likely(__pyx_t_13)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
        __pyx_t_5 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
      PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_t_1, __pyx_t_3};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
      PyObject *__pyx_temp[3] = {__pyx_t_13, __pyx_t_1, __pyx_t_3};
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    } else
    #endif
    {
      __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      if (__pyx_t_13) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_13); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_13); __pyx_t_13 = NULL;
      }
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_5, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_5, __pyx_t_3);
      __pyx_t_1 = 0;
      __pyx_t_3 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 168, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;sumOfSquared_to_alpha, 0);
    __pyx_v_self-&gt;sumOfSquared_to_alpha = __pyx_t_11;
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">169</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">170</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">171</span>:         # Apply weight after sumOfSquared has been computed but before the matrix is</pre>
<pre class="cython line score-0">&#xA0;<span class="">172</span>:         # split in its inner data structures</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>:         self.use_row_weights = False</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;use_row_weights = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">174</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">175</span>:         if row_weights is not None:</pre>
<pre class='cython code score-0 '>  __pyx_t_8 = (__pyx_v_row_weights != Py_None);
  __pyx_t_7 = (__pyx_t_8 != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">176</span>: </pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:             if dataMatrix.shape[0] != len(row_weights):</pre>
<pre class='cython code score-25 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_2, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_14 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_row_weights);<span class='error_goto'> if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 177, __pyx_L1_error)</span>
    __pyx_t_2 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_10, __pyx_t_2, Py_NE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 177, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_9); if (unlikely(__pyx_t_7 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 177, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(__pyx_t_7)) {
/* … */
    }
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:                 raise ValueError("Cosine_Similarity: provided row_weights and dataMatrix have different number of rows."</pre>
<pre class='cython code score-6 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_t_9);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 178, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
      <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_2, 0, 0, 0);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='error_goto'>__PYX_ERR(0, 178, __pyx_L1_error)</span>
</pre><pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">179</span>:                                  "Row_weights has {} rows, dataMatrix has {}.".format(len(row_weights), dataMatrix.shape[0]))</pre>
<pre class='cython code score-56 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_Cosine_Similarity_provided_row_w, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_14 = <span class='py_c_api'>PyObject_Length</span>(__pyx_v_row_weights);<span class='error_goto'> if (unlikely(__pyx_t_14 == ((Py_ssize_t)-1))) __PYX_ERR(0, 179, __pyx_L1_error)</span>
      __pyx_t_10 = <span class='py_c_api'>PyInt_FromSsize_t</span>(__pyx_t_14);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_shape);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_3, 0, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      __pyx_t_5 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
        __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
        if (likely(__pyx_t_3)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
          __pyx_t_5 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
        PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_10, __pyx_t_1};
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
        PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_t_10, __pyx_t_1};
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      } else
      #endif
      {
        __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
        if (__pyx_t_3) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_3); __pyx_t_3 = NULL;
        }
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+__pyx_t_5, __pyx_t_10);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1+__pyx_t_5, __pyx_t_1);
        __pyx_t_10 = 0;
        __pyx_t_1 = 0;
        __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 179, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">180</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">181</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:             self.use_row_weights = True</pre>
<pre class='cython code score-0 '>    __pyx_v_self-&gt;use_row_weights = 1;
</pre><pre class="cython line score-33" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">183</span>:             self.row_weights = np.array(row_weights, dtype=np.float64)</pre>
<pre class='cython code score-33 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_row_weights);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_row_weights);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_2, 0, __pyx_v_row_weights);
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_13, __pyx_n_s_dtype, __pyx_t_10) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_9, __pyx_t_2, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_10, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;row_weights, 0);
    __pyx_v_self-&gt;row_weights = __pyx_t_11;
    __pyx_t_11.memview = NULL;
    __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">184</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">185</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">186</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">187</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">188</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">189</span>:         dataMatrix = check_matrix(dataMatrix, 'csr')</pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_13, __pyx_n_s_check_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  __pyx_t_2 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_13)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_dataMatrix, __pyx_n_u_csr};
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_13)) {
    PyObject *__pyx_temp[3] = {__pyx_t_2, __pyx_v_dataMatrix, __pyx_n_u_csr};
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_13, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  } else
  #endif
  {
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    if (__pyx_t_2) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_2); __pyx_t_2 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dataMatrix);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0+__pyx_t_5, __pyx_v_dataMatrix);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_csr);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_csr);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1+__pyx_t_5, __pyx_n_u_csr);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_9, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 189, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_10);
  __pyx_t_10 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">190</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">191</span>:         self.user_to_item_row_ptr = dataMatrix.indptr</pre>
<pre class='cython code score-5 '>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 191, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_10, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 191, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;user_to_item_row_ptr, 0);
  __pyx_v_self-&gt;user_to_item_row_ptr = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:         self.user_to_item_cols = dataMatrix.indices</pre>
<pre class='cython code score-5 '>  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indices);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 192, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_10, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 192, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;user_to_item_cols, 0);
  __pyx_v_self-&gt;user_to_item_cols = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:         self.user_to_item_data = np.array(dataMatrix.data, dtype=np.float64)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_10, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_10);
  __pyx_t_10 = 0;
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_10, __pyx_n_s_dtype, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_13, __pyx_t_9, __pyx_t_10);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 193, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;user_to_item_data, 0);
  __pyx_v_self-&gt;user_to_item_data = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">194</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:         dataMatrix = check_matrix(dataMatrix, 'csc')</pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_10, __pyx_n_s_check_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  __pyx_t_9 = NULL;
  __pyx_t_5 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_10))) {
    __pyx_t_9 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_10);
    if (likely(__pyx_t_9)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_10);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_10, function);
      __pyx_t_5 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_dataMatrix, __pyx_n_u_csc};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_10)) {
    PyObject *__pyx_temp[3] = {__pyx_t_9, __pyx_v_dataMatrix, __pyx_n_u_csc};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_10, __pyx_temp+1-__pyx_t_5, 2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    if (__pyx_t_9) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_9); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_9); __pyx_t_9 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dataMatrix);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0+__pyx_t_5, __pyx_v_dataMatrix);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_csc);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_csc);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 1+__pyx_t_5, __pyx_n_u_csc);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_13, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 195, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:         self.item_to_user_rows = dataMatrix.indices</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indices);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 196, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 196, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;item_to_user_rows, 0);
  __pyx_v_self-&gt;item_to_user_rows = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:         self.item_to_user_col_ptr = dataMatrix.indptr</pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 197, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_12.memview)) __PYX_ERR(0, 197, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;item_to_user_col_ptr, 0);
  __pyx_v_self-&gt;item_to_user_col_ptr = __pyx_t_12;
  __pyx_t_12.memview = NULL;
  __pyx_t_12.data = NULL;
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">198</span>:         self.item_to_user_data = np.array(dataMatrix.data, dtype=np.float64)</pre>
<pre class='cython code score-34 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_13 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_13, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_9, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_9, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_10, __pyx_t_13, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_11.memview)) __PYX_ERR(0, 198, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;item_to_user_data, 0);
  __pyx_v_self-&gt;item_to_user_data = __pyx_t_11;
  __pyx_t_11.memview = NULL;
  __pyx_t_11.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">199</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">200</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">201</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">202</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:         if self.TopK == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_7 = ((__pyx_v_self-&gt;TopK == 0) != 0);
  if (__pyx_t_7) {
/* … */
  }
</pre><pre class="cython line score-34" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:             self.W_dense = np.zeros((self.n_columns,self.n_columns))</pre>
<pre class='cython code score-34 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_10)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_10);
    __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_10);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_10);
    __pyx_t_1 = 0;
    __pyx_t_10 = 0;
    __pyx_t_10 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_13))) {
      __pyx_t_10 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_13);
      if (likely(__pyx_t_10)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_13);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_10);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_13, function);
      }
    }
    __pyx_t_2 = (__pyx_t_10) ? __Pyx_PyObject_Call2Args(__pyx_t_13, __pyx_t_10, __pyx_t_9) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_13, __pyx_t_9);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_10); __pyx_t_10 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_dsds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_15.memview)) __PYX_ERR(0, 204, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_self-&gt;W_dense, 0);
    __pyx_v_self-&gt;W_dense = __pyx_t_15;
    __pyx_t_15.memview = NULL;
    __pyx_t_15.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">205</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">206</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">207</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">208</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">209</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:     cdef useOnlyBooleanInteractions(self, dataMatrix):</pre>
<pre class='cython code score-3 '>static PyObject *__pyx_f_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_useOnlyBooleanInteractions(CYTHON_UNUSED struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, PyObject *__pyx_v_dataMatrix) {
  long __pyx_v_index;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("useOnlyBooleanInteractions", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.useOnlyBooleanInteractions", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">211</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">212</span>:         Set to 1 all data points</pre>
<pre class="cython line score-0">&#xA0;<span class="">213</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">214</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">215</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">216</span>:         cdef long index</pre>
<pre class="cython line score-0">&#xA0;<span class="">217</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">218</span>:         for index in range(len(dataMatrix.data)):</pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 218, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='py_c_api'>PyObject_Length</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(__pyx_t_2 == ((Py_ssize_t)-1))) __PYX_ERR(0, 218, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_index = __pyx_t_4;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">219</span>:             dataMatrix.data[index] = 1</pre>
<pre class='cython code score-5 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 219, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_1, __pyx_v_index, __pyx_int_1, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 219, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">220</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">221</span>:         return dataMatrix</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
  __pyx_r = __pyx_v_dataMatrix;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">222</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">223</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:     cdef applyPearsonCorrelation(self, dataMatrix):</pre>
<pre class='cython code score-10 '>static PyObject *__pyx_f_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_applyPearsonCorrelation(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, PyObject *__pyx_v_dataMatrix) {
  __Pyx_memviewslice __pyx_v_sumPerCol = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_interactionsPerCol = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_colIndex;
  long __pyx_v_innerIndex;
  long __pyx_v_start_pos;
  long __pyx_v_end_pos;
  double __pyx_v_colAverage;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("applyPearsonCorrelation", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.applyPearsonCorrelation", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sumPerCol, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_interactionsPerCol, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dataMatrix);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">226</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">227</span>:         Remove from every data point the average for the corresponding column</pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>:         cdef double[:] sumPerCol</pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>:         cdef int[:] interactionsPerCol</pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>:         cdef long colIndex, innerIndex, start_pos, end_pos</pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>:         cdef double colAverage</pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:         dataMatrix = check_matrix(dataMatrix, 'csc')</pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_check_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_dataMatrix, __pyx_n_u_csc};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_dataMatrix, __pyx_n_u_csc};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dataMatrix);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_4, __pyx_v_dataMatrix);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_csc);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_csc);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_4, __pyx_n_u_csc);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 237, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">238</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-64" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">240</span>:         sumPerCol = np.array(dataMatrix.sum(axis=0), dtype=np.float64).ravel()</pre>
<pre class='cython code score-64 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_axis, __pyx_int_0) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_3, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_ravel);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
    }
  }
  __pyx_t_1 = (__pyx_t_7) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 240, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_sumPerCol = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>:         interactionsPerCol = np.diff(dataMatrix.indptr)</pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 241, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_diff);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 241, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 241, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 241, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 241, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_interactionsPerCol = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">242</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">243</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">244</span>:         #Remove for every row the corresponding average</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">245</span>:         for colIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>  __pyx_t_10 = __pyx_v_self-&gt;n_columns;
  __pyx_t_11 = __pyx_t_10;
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_colIndex = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">246</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:             if interactionsPerCol[colIndex]&gt;0:</pre>
<pre class='cython code score-0 '>    __pyx_t_13 = __pyx_v_colIndex;
    __pyx_t_14 = (((*((int *) ( /* dim=0 */ (__pyx_v_interactionsPerCol.data + __pyx_t_13 * __pyx_v_interactionsPerCol.strides[0]) ))) &gt; 0) != 0);
    if (__pyx_t_14) {
/* … */
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">248</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:                 colAverage = sumPerCol[colIndex] / interactionsPerCol[colIndex]</pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_v_colIndex;
      __pyx_t_16 = __pyx_v_colIndex;
      __pyx_v_colAverage = ((*((double *) ( /* dim=0 */ (__pyx_v_sumPerCol.data + __pyx_t_15 * __pyx_v_sumPerCol.strides[0]) ))) / ((double)(*((int *) ( /* dim=0 */ (__pyx_v_interactionsPerCol.data + __pyx_t_16 * __pyx_v_interactionsPerCol.strides[0]) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">250</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">251</span>:                 start_pos = dataMatrix.indptr[colIndex]</pre>
<pre class='cython code score-13 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, __pyx_v_colIndex, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_7); if (unlikely((__pyx_t_17 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 251, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_start_pos = __pyx_t_17;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">252</span>:                 end_pos = dataMatrix.indptr[colIndex+1]</pre>
<pre class='cython code score-13 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 252, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_17 = (__pyx_v_colIndex + 1);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_17, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 252, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_1); if (unlikely((__pyx_t_17 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 252, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_end_pos = __pyx_t_17;
</pre><pre class="cython line score-0">&#xA0;<span class="">253</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>:                 innerIndex = start_pos</pre>
<pre class='cython code score-0 '>      __pyx_v_innerIndex = __pyx_v_start_pos;
</pre><pre class="cython line score-0">&#xA0;<span class="">255</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">256</span>:                 while innerIndex &lt; end_pos:</pre>
<pre class='cython code score-0 '>      while (1) {
        __pyx_t_14 = ((__pyx_v_innerIndex &lt; __pyx_v_end_pos) != 0);
        if (!__pyx_t_14) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">257</span>: </pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">258</span>:                     dataMatrix.data[innerIndex] -= colAverage</pre>
<pre class='cython code score-20 '>        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 258, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_17 = __pyx_v_innerIndex;
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, __pyx_t_17, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 258, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_colAverage);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 258, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_3 = <span class='py_c_api'>PyNumber_InPlaceSubtract</span>(__pyx_t_7, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 258, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_1, __pyx_t_17, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 258, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:                     innerIndex+=1</pre>
<pre class='cython code score-0 '>        __pyx_v_innerIndex = (__pyx_v_innerIndex + 1);
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">260</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">261</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">262</span>:         return dataMatrix</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
  __pyx_r = __pyx_v_dataMatrix;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">263</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">264</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">265</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:     cdef applyAdjustedCosine(self, dataMatrix):</pre>
<pre class='cython code score-10 '>static PyObject *__pyx_f_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_applyAdjustedCosine(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, PyObject *__pyx_v_dataMatrix) {
  __Pyx_memviewslice __pyx_v_sumPerRow = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_interactionsPerRow = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_rowIndex;
  long __pyx_v_innerIndex;
  long __pyx_v_start_pos;
  long __pyx_v_end_pos;
  double __pyx_v_rowAverage;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("applyAdjustedCosine", 0);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_9, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.applyAdjustedCosine", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_sumPerRow, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_interactionsPerRow, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_dataMatrix);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">267</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">268</span>:         Remove from every data point the average for the corresponding row</pre>
<pre class="cython line score-0">&#xA0;<span class="">269</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">270</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">271</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">272</span>:         cdef double[:] sumPerRow</pre>
<pre class="cython line score-0">&#xA0;<span class="">273</span>:         cdef int[:] interactionsPerRow</pre>
<pre class="cython line score-0">&#xA0;<span class="">274</span>:         cdef long rowIndex, innerIndex, start_pos, end_pos</pre>
<pre class="cython line score-0">&#xA0;<span class="">275</span>:         cdef double rowAverage</pre>
<pre class="cython line score-0">&#xA0;<span class="">276</span>: </pre>
<pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">277</span>:         dataMatrix = check_matrix(dataMatrix, 'csr')</pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_check_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 277, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  __pyx_t_4 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_4 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_dataMatrix, __pyx_n_u_csr};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_dataMatrix, __pyx_n_u_csr};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_4, 2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  } else
  #endif
  {
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 277, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_dataMatrix);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_4, __pyx_v_dataMatrix);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_u_csr);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_u_csr);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_4, __pyx_n_u_csr);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 277, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_dataMatrix, __pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">278</span>: </pre>
<pre class="cython line score-64" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:         sumPerRow = np.array(dataMatrix.sum(axis=1), dtype=np.float64).ravel()</pre>
<pre class='cython code score-64 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_sum);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_3, __pyx_n_s_axis, __pyx_int_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 279, __pyx_L1_error)</span>
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_empty_tuple, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_6);
  __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_6, __pyx_n_s_dtype, __pyx_t_7) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_3, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_ravel);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_7 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_7)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
    }
  }
  __pyx_t_1 = (__pyx_t_7) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 279, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_sumPerRow = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:         interactionsPerRow = np.diff(dataMatrix.indptr)</pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 280, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_diff);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 280, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 280, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_3, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 280, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_1, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_9.memview)) __PYX_ERR(0, 280, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_interactionsPerRow = __pyx_t_9;
  __pyx_t_9.memview = NULL;
  __pyx_t_9.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">281</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">282</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">283</span>:         #Remove for every row the corresponding average</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">284</span>:         for rowIndex in range(self.n_rows):</pre>
<pre class='cython code score-0 '>  __pyx_t_10 = __pyx_v_self-&gt;n_rows;
  __pyx_t_11 = __pyx_t_10;
  for (__pyx_t_12 = 0; __pyx_t_12 &lt; __pyx_t_11; __pyx_t_12+=1) {
    __pyx_v_rowIndex = __pyx_t_12;
</pre><pre class="cython line score-0">&#xA0;<span class="">285</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:             if interactionsPerRow[rowIndex]&gt;0:</pre>
<pre class='cython code score-0 '>    __pyx_t_13 = __pyx_v_rowIndex;
    __pyx_t_14 = (((*((int *) ( /* dim=0 */ (__pyx_v_interactionsPerRow.data + __pyx_t_13 * __pyx_v_interactionsPerRow.strides[0]) ))) &gt; 0) != 0);
    if (__pyx_t_14) {
/* … */
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">287</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">288</span>:                 rowAverage = sumPerRow[rowIndex] / interactionsPerRow[rowIndex]</pre>
<pre class='cython code score-0 '>      __pyx_t_15 = __pyx_v_rowIndex;
      __pyx_t_16 = __pyx_v_rowIndex;
      __pyx_v_rowAverage = ((*((double *) ( /* dim=0 */ (__pyx_v_sumPerRow.data + __pyx_t_15 * __pyx_v_sumPerRow.strides[0]) ))) / ((double)(*((int *) ( /* dim=0 */ (__pyx_v_interactionsPerRow.data + __pyx_t_16 * __pyx_v_interactionsPerRow.strides[0]) )))));
</pre><pre class="cython line score-0">&#xA0;<span class="">289</span>: </pre>
<pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">290</span>:                 start_pos = dataMatrix.indptr[rowIndex]</pre>
<pre class='cython code score-13 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, __pyx_v_rowIndex, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 290, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_7); if (unlikely((__pyx_t_17 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 290, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_v_start_pos = __pyx_t_17;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">291</span>:                 end_pos = dataMatrix.indptr[rowIndex+1]</pre>
<pre class='cython code score-13 '>      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_indptr);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 291, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_17 = (__pyx_v_rowIndex + 1);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_7, __pyx_t_17, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 291, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_17 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_1); if (unlikely((__pyx_t_17 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 291, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
      __pyx_v_end_pos = __pyx_t_17;
</pre><pre class="cython line score-0">&#xA0;<span class="">292</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">293</span>:                 innerIndex = start_pos</pre>
<pre class='cython code score-0 '>      __pyx_v_innerIndex = __pyx_v_start_pos;
</pre><pre class="cython line score-0">&#xA0;<span class="">294</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>:                 while innerIndex &lt; end_pos:</pre>
<pre class='cython code score-0 '>      while (1) {
        __pyx_t_14 = ((__pyx_v_innerIndex &lt; __pyx_v_end_pos) != 0);
        if (!__pyx_t_14) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">296</span>: </pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">297</span>:                     dataMatrix.data[innerIndex] -= rowAverage</pre>
<pre class='cython code score-20 '>        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_dataMatrix, __pyx_n_s_data);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 297, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        __pyx_t_17 = __pyx_v_innerIndex;
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_GetItemInt</span>(__pyx_t_1, __pyx_t_17, long, 1, __Pyx_PyInt_From_long, 0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 297, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_6 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_v_rowAverage);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 297, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        __pyx_t_3 = <span class='py_c_api'>PyNumber_InPlaceSubtract</span>(__pyx_t_7, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 297, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        if (unlikely(<span class='pyx_c_api'>__Pyx_SetItemInt</span>(__pyx_t_1, __pyx_t_17, __pyx_t_3, long, 1, __Pyx_PyInt_From_long, 0, 0, 0) &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 297, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:                     innerIndex+=1</pre>
<pre class='cython code score-0 '>        __pyx_v_innerIndex = (__pyx_v_innerIndex + 1);
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">299</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">300</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">301</span>:         return dataMatrix</pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_dataMatrix);
  __pyx_r = __pyx_v_dataMatrix;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">302</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">303</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">304</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">305</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">306</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">307</span>:     cdef int[:] getUsersThatRatedItem(self, long item_id):</pre>
<pre class='cython code score-7 '>static __Pyx_memviewslice __pyx_f_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_getUsersThatRatedItem(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, long __pyx_v_item_id) {
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getUsersThatRatedItem", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.getUsersThatRatedItem", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:         return self.item_to_user_rows[self.item_to_user_col_ptr[item_id]:self.item_to_user_col_ptr[item_id+1]]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_item_id;
  __pyx_t_2 = (__pyx_v_item_id + 1);
  __pyx_t_3.data = __pyx_v_self-&gt;item_to_user_rows.data;
  __pyx_t_3.memview = __pyx_v_self-&gt;item_to_user_rows.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_3, 0);
  __pyx_t_4 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_3,
    __pyx_v_self-&gt;item_to_user_rows.shape[0], __pyx_v_self-&gt;item_to_user_rows.strides[0], __pyx_v_self-&gt;item_to_user_rows.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_4,
    (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;item_to_user_col_ptr.data + __pyx_t_1 * __pyx_v_self-&gt;item_to_user_col_ptr.strides[0]) ))),
    (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;item_to_user_col_ptr.data + __pyx_t_2 * __pyx_v_self-&gt;item_to_user_col_ptr.strides[0]) ))),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 308, __pyx_L1_error)</span>
}

__pyx_r = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">309</span>: </pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:     cdef int[:] getItemsRatedByUser(self, long user_id):</pre>
<pre class='cython code score-7 '>static __Pyx_memviewslice __pyx_f_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_getItemsRatedByUser(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, long __pyx_v_user_id) {
  __Pyx_memviewslice __pyx_r = { 0, 0, { 0 }, { 0 }, { 0 } };
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("getItemsRatedByUser", 0);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_3, 1);
  __pyx_r.data = NULL;
  __pyx_r.memview = NULL;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.getItemsRatedByUser", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  if (unlikely(!__pyx_r.memview)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_TypeError, "Memoryview return value is not initialized");
  }
  __pyx_L2:;
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">311</span>:         return self.user_to_item_cols[self.user_to_item_row_ptr[user_id]:self.user_to_item_row_ptr[user_id+1]]</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_user_id;
  __pyx_t_2 = (__pyx_v_user_id + 1);
  __pyx_t_3.data = __pyx_v_self-&gt;user_to_item_cols.data;
  __pyx_t_3.memview = __pyx_v_self-&gt;user_to_item_cols.memview;
  __PYX_INC_MEMVIEW(&amp;__pyx_t_3, 0);
  __pyx_t_4 = -1;
  if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_3,
    __pyx_v_self-&gt;user_to_item_cols.shape[0], __pyx_v_self-&gt;user_to_item_cols.strides[0], __pyx_v_self-&gt;user_to_item_cols.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_4,
    (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;user_to_item_row_ptr.data + __pyx_t_1 * __pyx_v_self-&gt;user_to_item_row_ptr.strides[0]) ))),
    (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;user_to_item_row_ptr.data + __pyx_t_2 * __pyx_v_self-&gt;user_to_item_row_ptr.strides[0]) ))),
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 311, __pyx_L1_error)</span>
}

__pyx_r = __pyx_t_3;
  __pyx_t_3.memview = NULL;
  __pyx_t_3.data = NULL;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">312</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">313</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">315</span>: </pre>
<pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">316</span>:     cdef computeItemSimilarities(self, long item_id_input):</pre>
<pre class='cython code score-3 '>static PyObject *__pyx_f_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_computeItemSimilarities(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, long __pyx_v_item_id_input) {
  long __pyx_v_user_index;
  long __pyx_v_user_id;
  long __pyx_v_item_index;
  long __pyx_v_item_id;
  long __pyx_v_item_id_second;
  __Pyx_memviewslice __pyx_v_users_that_rated_item = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_items_rated_by_user = { 0, 0, { 0 }, { 0 }, { 0 } };
  double __pyx_v_rating_item_input;
  double __pyx_v_rating_item_second;
  double __pyx_v_row_weight;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("computeItemSimilarities", 0);
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_1, 1);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.computeItemSimilarities", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = 0;
  __pyx_L0:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_users_that_rated_item, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_items_rated_by_user, 1);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">317</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">318</span>:         For every item the cosine similarity against other items depends on whether they have users in common. The more</pre>
<pre class="cython line score-0">&#xA0;<span class="">319</span>:         common users the higher the similarity.</pre>
<pre class="cython line score-0">&#xA0;<span class="">320</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">321</span>:         The basic implementation is:</pre>
<pre class="cython line score-0">&#xA0;<span class="">322</span>:         - Select the first item</pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>:         - Loop through all other items</pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>:         -- Given the two items, get the users they have in common</pre>
<pre class="cython line score-0">&#xA0;<span class="">325</span>:         -- Update the similarity for all common users</pre>
<pre class="cython line score-0">&#xA0;<span class="">326</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">327</span>:         That is VERY slow due to the common user part, in which a long data structure is looped multiple times.</pre>
<pre class="cython line score-0">&#xA0;<span class="">328</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">329</span>:         A better way is to use the data structure in a different way skipping the search part, getting directly the</pre>
<pre class="cython line score-0">&#xA0;<span class="">330</span>:         information we need.</pre>
<pre class="cython line score-0">&#xA0;<span class="">331</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">332</span>:         The implementation here used is:</pre>
<pre class="cython line score-0">&#xA0;<span class="">333</span>:         - Select the first item</pre>
<pre class="cython line score-0">&#xA0;<span class="">334</span>:         - Initialize a zero valued array for the similarities</pre>
<pre class="cython line score-0">&#xA0;<span class="">335</span>:         - Get the users who rated the first item</pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>:         - Loop through the users</pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>:         -- Given a user, get the items he rated (second item)</pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>:         -- Update the similarity of the items he rated</pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">341</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">342</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>:         # Create template used to initialize an array with zeros</pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>:         # Much faster than np.zeros(self.n_columns)</pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>:         #cdef array[double] template_zero = array('d')</pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>:         #cdef array[double] result = clone(template_zero, self.n_columns, zero=True)</pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">349</span>:         cdef long user_index, user_id, item_index, item_id, item_id_second</pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">351</span>:         cdef int[:] users_that_rated_item = self.getUsersThatRatedItem(item_id_input)</pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self-&gt;__pyx_vtab)-&gt;getUsersThatRatedItem(__pyx_v_self, __pyx_v_item_id_input);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 351, __pyx_L1_error)</span>
  __pyx_v_users_that_rated_item = __pyx_t_1;
  __pyx_t_1.memview = NULL;
  __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">352</span>:         cdef int[:] items_rated_by_user</pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">354</span>:         cdef double rating_item_input, rating_item_second, row_weight</pre>
<pre class="cython line score-0">&#xA0;<span class="">355</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">356</span>:         # Clean previous item</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">357</span>:         for item_index in range(self.this_item_weights_counter):</pre>
<pre class='cython code score-0 '>  __pyx_t_2 = __pyx_v_self-&gt;this_item_weights_counter;
  __pyx_t_3 = __pyx_t_2;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_3; __pyx_t_4+=1) {
    __pyx_v_item_index = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>:             item_id = self.this_item_weights_id[item_index]</pre>
<pre class='cython code score-0 '>    __pyx_t_5 = __pyx_v_item_index;
    __pyx_v_item_id = (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_id.data + __pyx_t_5 * __pyx_v_self-&gt;this_item_weights_id.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>:             self.this_item_weights_mask[item_id] = False</pre>
<pre class='cython code score-0 '>    __pyx_t_6 = __pyx_v_item_id;
    *((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_mask.data + __pyx_t_6 * __pyx_v_self-&gt;this_item_weights_mask.strides[0]) )) = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">360</span>:             self.this_item_weights[item_id] = 0.0</pre>
<pre class='cython code score-0 '>    __pyx_t_7 = __pyx_v_item_id;
    *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_7 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) = 0.0;
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">361</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>:         self.this_item_weights_counter = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;this_item_weights_counter = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">363</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">364</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">365</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">366</span>:         # Get users that rated the items</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">367</span>:         for user_index in range(len(users_that_rated_item)):</pre>
<pre class='cython code score-2 '>  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_users_that_rated_item); 
  __pyx_t_9 = __pyx_t_8;
  for (__pyx_t_4 = 0; __pyx_t_4 &lt; __pyx_t_9; __pyx_t_4+=1) {
    __pyx_v_user_index = __pyx_t_4;
</pre><pre class="cython line score-0">&#xA0;<span class="">368</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">369</span>:             user_id = users_that_rated_item[user_index]</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = __pyx_v_user_index;
    __pyx_v_user_id = (*((int *) ( /* dim=0 */ (__pyx_v_users_that_rated_item.data + __pyx_t_10 * __pyx_v_users_that_rated_item.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">370</span>:             rating_item_input = self.item_to_user_data[self.item_to_user_col_ptr[item_id_input]+user_index]</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = __pyx_v_item_id_input;
    __pyx_t_12 = ((*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;item_to_user_col_ptr.data + __pyx_t_11 * __pyx_v_self-&gt;item_to_user_col_ptr.strides[0]) ))) + __pyx_v_user_index);
    __pyx_v_rating_item_input = (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;item_to_user_data.data + __pyx_t_12 * __pyx_v_self-&gt;item_to_user_data.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">371</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">372</span>:             if self.use_row_weights:</pre>
<pre class='cython code score-0 '>    __pyx_t_13 = (__pyx_v_self-&gt;use_row_weights != 0);
    if (__pyx_t_13) {
/* … */
      goto __pyx_L7;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">373</span>:                 row_weight = self.row_weights[user_id]</pre>
<pre class='cython code score-0 '>      __pyx_t_14 = __pyx_v_user_id;
      __pyx_v_row_weight = (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;row_weights.data + __pyx_t_14 * __pyx_v_self-&gt;row_weights.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">374</span>:             else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">375</span>:                 row_weight = 1.0</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_v_row_weight = 1.0;
    }
    __pyx_L7:;
</pre><pre class="cython line score-0">&#xA0;<span class="">376</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">377</span>:             # Get all items rated by that user</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">378</span>:             items_rated_by_user = self.getItemsRatedByUser(user_id)</pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self-&gt;__pyx_vtab)-&gt;getItemsRatedByUser(__pyx_v_self, __pyx_v_user_id);<span class='error_goto'> if (unlikely(!__pyx_t_1.memview)) __PYX_ERR(0, 378, __pyx_L1_error)</span>
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_items_rated_by_user, 1);
    __pyx_v_items_rated_by_user = __pyx_t_1;
    __pyx_t_1.memview = NULL;
    __pyx_t_1.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">379</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">380</span>:             for item_index in range(len(items_rated_by_user)):</pre>
<pre class='cython code score-2 '>    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_items_rated_by_user); 
    __pyx_t_16 = __pyx_t_15;
    for (__pyx_t_17 = 0; __pyx_t_17 &lt; __pyx_t_16; __pyx_t_17+=1) {
      __pyx_v_item_index = __pyx_t_17;
</pre><pre class="cython line score-0">&#xA0;<span class="">381</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">382</span>:                 item_id_second = items_rated_by_user[item_index]</pre>
<pre class='cython code score-0 '>      __pyx_t_18 = __pyx_v_item_index;
      __pyx_v_item_id_second = (*((int *) ( /* dim=0 */ (__pyx_v_items_rated_by_user.data + __pyx_t_18 * __pyx_v_items_rated_by_user.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">383</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>:                 # Do not compute the similarity on the diagonal</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">385</span>:                 if item_id_second != item_id_input:</pre>
<pre class='cython code score-0 '>      __pyx_t_13 = ((__pyx_v_item_id_second != __pyx_v_item_id_input) != 0);
      if (__pyx_t_13) {
/* … */
      }
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">386</span>:                     # Increment similairty</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">387</span>:                     rating_item_second = self.user_to_item_data[self.user_to_item_row_ptr[user_id]+item_index]</pre>
<pre class='cython code score-0 '>        __pyx_t_19 = __pyx_v_user_id;
        __pyx_t_20 = ((*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;user_to_item_row_ptr.data + __pyx_t_19 * __pyx_v_self-&gt;user_to_item_row_ptr.strides[0]) ))) + __pyx_v_item_index);
        __pyx_v_rating_item_second = (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;user_to_item_data.data + __pyx_t_20 * __pyx_v_self-&gt;user_to_item_data.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">388</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">389</span>:                     self.this_item_weights[item_id_second] += rating_item_input*rating_item_second*row_weight</pre>
<pre class='cython code score-0 '>        __pyx_t_21 = __pyx_v_item_id_second;
        *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_21 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) += ((__pyx_v_rating_item_input * __pyx_v_rating_item_second) * __pyx_v_row_weight);
</pre><pre class="cython line score-0">&#xA0;<span class="">390</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">391</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">392</span>:                     # Update global data structure</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>:                     if not self.this_item_weights_mask[item_id_second]:</pre>
<pre class='cython code score-0 '>        __pyx_t_22 = __pyx_v_item_id_second;
        __pyx_t_13 = ((!((*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_mask.data + __pyx_t_22 * __pyx_v_self-&gt;this_item_weights_mask.strides[0]) ))) != 0)) != 0);
        if (__pyx_t_13) {
/* … */
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">394</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">395</span>:                         self.this_item_weights_mask[item_id_second] = True</pre>
<pre class='cython code score-0 '>          __pyx_t_23 = __pyx_v_item_id_second;
          *((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_mask.data + __pyx_t_23 * __pyx_v_self-&gt;this_item_weights_mask.strides[0]) )) = 1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:                         self.this_item_weights_id[self.this_item_weights_counter] = item_id_second</pre>
<pre class='cython code score-0 '>          __pyx_t_24 = __pyx_v_self-&gt;this_item_weights_counter;
          *((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_id.data + __pyx_t_24 * __pyx_v_self-&gt;this_item_weights_id.strides[0]) )) = __pyx_v_item_id_second;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">397</span>:                         self.this_item_weights_counter += 1</pre>
<pre class='cython code score-0 '>          __pyx_v_self-&gt;this_item_weights_counter = (__pyx_v_self-&gt;this_item_weights_counter + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">398</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">399</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">400</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">401</span>: </pre>
<pre class="cython line score-60" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">402</span>:     def compute_similarity(self, start_col=None, end_col=None):</pre>
<pre class='cython code score-60 '>/* Python wrapper */
static PyObject *__pyx_pw_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_3compute_similarity(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_2compute_similarity[] = "\n        Compute the similarity for the given dataset\n        :param self:\n        :param start_col: column to begin with\n        :param end_col: column to stop before, end_col is excluded\n        :return:\n        ";
static PyObject *__pyx_pw_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_3compute_similarity(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_start_col = 0;
  PyObject *__pyx_v_end_col = 0;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("compute_similarity (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_start_col,&amp;__pyx_n_s_end_col,0};
    PyObject* values[2] = {0,0};
    values[0] = ((PyObject *)Py_None);
    values[1] = ((PyObject *)Py_None);
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_start_col);
          if (value) { values[0] = value; kw_args--; }
        }
        CYTHON_FALLTHROUGH;
        case  1:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_end_col);
          if (value) { values[1] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "compute_similarity") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_start_col = values[0];
    __pyx_v_end_col = values[1];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("compute_similarity", 0, 0, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 402, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.compute_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_2compute_similarity(((struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self), __pyx_v_start_col, __pyx_v_end_col);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_25Compute_Similarity_Cython_2compute_similarity(struct __pyx_obj_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *__pyx_v_self, PyObject *__pyx_v_start_col, PyObject *__pyx_v_end_col) {
  int __pyx_v_print_block_size;
  int __pyx_v_itemIndex;
  int __pyx_v_innerItemIndex;
  int __pyx_v_item_id;
  int __pyx_v_local_topK;
  PY_LONG_LONG __pyx_v_topKItemIndex;
  __Pyx_memviewslice __pyx_v_top_k_idx = { 0, 0, { 0 }, { 0 }, { 0 } };
  PyArrayObject *__pyx_v_top_k_partition = 0;
  PyArrayObject *__pyx_v_top_k_partition_sorting = 0;
  PyArrayObject *__pyx_v_this_item_weights_np = 0;
  long __pyx_v_processedItems;
  __Pyx_memviewslice __pyx_v_values = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_rows = { 0, 0, { 0 }, { 0 }, { 0 } };
  __Pyx_memviewslice __pyx_v_cols = { 0, 0, { 0 }, { 0 }, { 0 } };
  long __pyx_v_sparse_data_pointer;
  int __pyx_v_start_col_local;
  int __pyx_v_end_col_local;
  CYTHON_UNUSED arrayobject *__pyx_v_template_zero = 0;
  PyObject *__pyx_v_start_time = NULL;
  PyObject *__pyx_v_last_print_time = NULL;
  PyObject *__pyx_v_current_time = NULL;
  PyObject *__pyx_v_itemPerSec = NULL;
  PyObject *__pyx_v_W_sparse = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_template_zero;
  __Pyx_Buffer __pyx_pybuffer_template_zero;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_this_item_weights_np;
  __Pyx_Buffer __pyx_pybuffer_this_item_weights_np;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_top_k_partition;
  __Pyx_Buffer __pyx_pybuffer_top_k_partition;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_top_k_partition_sorting;
  __Pyx_Buffer __pyx_pybuffer_top_k_partition_sorting;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("compute_similarity", 0);
  __pyx_pybuffer_top_k_partition.pybuffer.buf = NULL;
  __pyx_pybuffer_top_k_partition.refcount = 0;
  __pyx_pybuffernd_top_k_partition.data = NULL;
  __pyx_pybuffernd_top_k_partition.rcbuffer = &amp;__pyx_pybuffer_top_k_partition;
  __pyx_pybuffer_top_k_partition_sorting.pybuffer.buf = NULL;
  __pyx_pybuffer_top_k_partition_sorting.refcount = 0;
  __pyx_pybuffernd_top_k_partition_sorting.data = NULL;
  __pyx_pybuffernd_top_k_partition_sorting.rcbuffer = &amp;__pyx_pybuffer_top_k_partition_sorting;
  __pyx_pybuffer_this_item_weights_np.pybuffer.buf = NULL;
  __pyx_pybuffer_this_item_weights_np.refcount = 0;
  __pyx_pybuffernd_this_item_weights_np.data = NULL;
  __pyx_pybuffernd_this_item_weights_np.rcbuffer = &amp;__pyx_pybuffer_this_item_weights_np;
  __pyx_pybuffer_template_zero.pybuffer.buf = NULL;
  __pyx_pybuffer_template_zero.refcount = 0;
  __pyx_pybuffernd_template_zero.data = NULL;
  __pyx_pybuffernd_template_zero.rcbuffer = &amp;__pyx_pybuffer_template_zero;
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_t_48, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_58);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_59);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("recsys.Base.Similarity.Cython.Compute_Similarity_Cython.Compute_Similarity_Cython.compute_similarity", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_top_k_idx, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_top_k_partition);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_top_k_partition_sorting);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_this_item_weights_np);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_values, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_rows, 1);
  __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cols, 1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_template_zero);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_start_time);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_last_print_time);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_current_time);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_itemPerSec);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_W_sparse);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">403</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">404</span>:         Compute the similarity for the given dataset</pre>
<pre class="cython line score-0">&#xA0;<span class="">405</span>:         :param self:</pre>
<pre class="cython line score-0">&#xA0;<span class="">406</span>:         :param start_col: column to begin with</pre>
<pre class="cython line score-0">&#xA0;<span class="">407</span>:         :param end_col: column to stop before, end_col is excluded</pre>
<pre class="cython line score-0">&#xA0;<span class="">408</span>:         :return:</pre>
<pre class="cython line score-0">&#xA0;<span class="">409</span>:         """</pre>
<pre class="cython line score-0">&#xA0;<span class="">410</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">411</span>:         cdef int print_block_size = 500</pre>
<pre class='cython code score-0 '>  __pyx_v_print_block_size = 0x1F4;
</pre><pre class="cython line score-0">&#xA0;<span class="">412</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">413</span>:         cdef int itemIndex, innerItemIndex, item_id, local_topK</pre>
<pre class="cython line score-0">&#xA0;<span class="">414</span>:         cdef long long topKItemIndex</pre>
<pre class="cython line score-0">&#xA0;<span class="">415</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">416</span>:         cdef long long[:] top_k_idx</pre>
<pre class="cython line score-0">&#xA0;<span class="">417</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">418</span>:         # Declare numpy data type to use vetor indexing and simplify the topK selection code</pre>
<pre class="cython line score-0">&#xA0;<span class="">419</span>:         cdef np.ndarray[LONG_t, ndim=1] top_k_partition, top_k_partition_sorting</pre>
<pre class="cython line score-36" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">420</span>:         cdef np.ndarray[np.float64_t, ndim=1] this_item_weights_np = np.zeros(self.n_columns, dtype=np.float64)</pre>
<pre class='cython code score-36 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 420, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (!(likely(((__pyx_t_5) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_5, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 420, __pyx_L1_error)</span>
  __pyx_t_6 = ((PyArrayObject *)__pyx_t_5);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_6, &amp;__Pyx_TypeInfo_nn___pyx_t_5numpy_float64_t, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_this_item_weights_np = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 420, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_this_item_weights_np.diminfo[0].strides = __pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_this_item_weights_np.diminfo[0].shape = __pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer.shape[0];
    }
  }
  __pyx_t_6 = 0;
  __pyx_v_this_item_weights_np = ((PyArrayObject *)__pyx_t_5);
  __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">421</span>:         #cdef double[:] this_item_weights</pre>
<pre class="cython line score-0">&#xA0;<span class="">422</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">423</span>:         cdef long processedItems = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_processedItems = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">424</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">425</span>:         # Data structure to incrementally build sparse matrix</pre>
<pre class="cython line score-0">&#xA0;<span class="">426</span>:         # Preinitialize max possible length</pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">427</span>:         cdef double[:] values = np.zeros((self.n_columns*self.TopK))</pre>
<pre class='cython code score-25 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 427, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_self-&gt;n_columns * __pyx_v_self-&gt;TopK));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 427, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 427, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_5, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 427, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_values = __pyx_t_7;
  __pyx_t_7.memview = NULL;
  __pyx_t_7.data = NULL;
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">428</span>:         cdef int[:] rows = np.zeros((self.n_columns*self.TopK,), dtype=np.int32)</pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_self-&gt;n_columns * __pyx_v_self-&gt;TopK));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_1);
  __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_int32);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_5, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_4, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 428, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_rows = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class="cython line score-40" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">429</span>:         cdef int[:] cols = np.zeros((self.n_columns*self.TopK,), dtype=np.int32)</pre>
<pre class='cython code score-40 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_zeros);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_self-&gt;n_columns * __pyx_v_self-&gt;TopK));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_4);
  __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_5);
  __pyx_t_5 = 0;
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_int32);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_dtype, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_1, __pyx_t_4, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 429, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_cols = __pyx_t_8;
  __pyx_t_8.memview = NULL;
  __pyx_t_8.data = NULL;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">430</span>:         cdef long sparse_data_pointer = 0</pre>
<pre class='cython code score-0 '>  __pyx_v_sparse_data_pointer = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">431</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">432</span>:         cdef int start_col_local = 0, end_col_local = self.n_columns</pre>
<pre class='cython code score-0 '>  __pyx_v_start_col_local = 0;
  __pyx_t_9 = __pyx_v_self-&gt;n_columns;
  __pyx_v_end_col_local = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">433</span>: </pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">434</span>:         cdef array[double] template_zero = array('d')</pre>
<pre class='cython code score-10 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(((PyObject *)__pyx_ptype_7cpython_5array_array), __pyx_tuple_, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer, (PyObject*)((arrayobject *)__pyx_t_2), &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_INDIRECT, 1, 0, __pyx_stack) == -1)) {
      __pyx_v_template_zero = ((arrayobject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 434, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_template_zero.diminfo[0].strides = __pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_template_zero.diminfo[0].shape = __pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_template_zero.diminfo[0].suboffsets = __pyx_pybuffernd_template_zero.rcbuffer-&gt;pybuffer.suboffsets[0];
    }
  }
  __pyx_v_template_zero = ((arrayobject *)__pyx_t_2);
  __pyx_t_2 = 0;
/* … */
  __pyx_tuple_ = <span class='py_c_api'>PyTuple_Pack</span>(1, __pyx_n_u_d);<span class='error_goto'> if (unlikely(!__pyx_tuple_)) __PYX_ERR(0, 434, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_tuple_);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_tuple_);
</pre><pre class="cython line score-0">&#xA0;<span class="">435</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">436</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">437</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">438</span>:         if start_col is not None and start_col&gt;0 and start_col&lt;self.n_columns:</pre>
<pre class='cython code score-19 '>  __pyx_t_11 = (__pyx_v_start_col != Py_None);
  __pyx_t_12 = (__pyx_t_11 != 0);
  if (__pyx_t_12) {
  } else {
    __pyx_t_10 = __pyx_t_12;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_start_col, __pyx_int_0, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_12 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_12) {
  } else {
    __pyx_t_10 = __pyx_t_12;
    goto __pyx_L4_bool_binop_done;
  }
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_start_col, __pyx_t_2, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5); if (unlikely(__pyx_t_12 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 438, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_10 = __pyx_t_12;
  __pyx_L4_bool_binop_done:;
  if (__pyx_t_10) {
/* … */
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">439</span>:             start_col_local = start_col</pre>
<pre class='cython code score-7 '>    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_start_col); if (unlikely((__pyx_t_13 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 439, __pyx_L1_error)</span>
    __pyx_v_start_col_local = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">440</span>: </pre>
<pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">441</span>:         if end_col is not None and end_col&gt;start_col_local and end_col&lt;self.n_columns:</pre>
<pre class='cython code score-22 '>  __pyx_t_12 = (__pyx_v_end_col != Py_None);
  __pyx_t_11 = (__pyx_t_12 != 0);
  if (__pyx_t_11) {
  } else {
    __pyx_t_10 = __pyx_t_11;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_start_col_local);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_2 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_end_col, __pyx_t_5, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_2); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (__pyx_t_11) {
  } else {
    __pyx_t_10 = __pyx_t_11;
    goto __pyx_L8_bool_binop_done;
  }
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_5 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_end_col, __pyx_t_2, Py_LT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 441, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_t_10 = __pyx_t_11;
  __pyx_L8_bool_binop_done:;
  if (__pyx_t_10) {
/* … */
  }
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">442</span>:             end_col_local = end_col</pre>
<pre class='cython code score-7 '>    __pyx_t_13 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_end_col); if (unlikely((__pyx_t_13 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 442, __pyx_L1_error)</span>
    __pyx_v_end_col_local = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">443</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">444</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">445</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">446</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">447</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">448</span>: </pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">449</span>:         start_time = time.time()</pre>
<pre class='cython code score-21 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 449, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 449, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_5 = (__pyx_t_2) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 449, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_v_start_time = __pyx_t_5;
  __pyx_t_5 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">450</span>:         last_print_time = start_time</pre>
<pre class='cython code score-1 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_start_time);
  __pyx_v_last_print_time = __pyx_v_start_time;
</pre><pre class="cython line score-0">&#xA0;<span class="">451</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">452</span>:         itemIndex = start_col_local</pre>
<pre class='cython code score-0 '>  __pyx_v_itemIndex = __pyx_v_start_col_local;
</pre><pre class="cython line score-0">&#xA0;<span class="">453</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">454</span>:         # Compute all similarities for each item</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">455</span>:         while itemIndex &lt; end_col_local:</pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_10 = ((__pyx_v_itemIndex &lt; __pyx_v_end_col_local) != 0);
    if (!__pyx_t_10) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">456</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">457</span>:             processedItems += 1</pre>
<pre class='cython code score-0 '>    __pyx_v_processedItems = (__pyx_v_processedItems + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">458</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">459</span>:             # Computed similarities go in self.this_item_weights</pre>
<pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">460</span>:             self.computeItemSimilarities(itemIndex)</pre>
<pre class='cython code score-1 '>    __pyx_t_5 = ((struct __pyx_vtabstruct_6recsys_4Base_10Similarity_6Cython_25Compute_Similarity_Cython_Compute_Similarity_Cython *)__pyx_v_self-&gt;__pyx_vtab)-&gt;computeItemSimilarities(__pyx_v_self, __pyx_v_itemIndex);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 460, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">461</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">462</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">463</span>:             # Apply normalization and shrinkage, ensure denominator != 0</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">464</span>:             if self.normalize:</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = (__pyx_v_self-&gt;normalize != 0);
    if (__pyx_t_10) {
/* … */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">465</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0">&#xA0;<span class="">466</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">467</span>:                     if self.asymmetric_cosine:</pre>
<pre class='cython code score-0 '>        __pyx_t_10 = (__pyx_v_self-&gt;asymmetric_cosine != 0);
        if (__pyx_t_10) {
/* … */
          goto __pyx_L16;
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">468</span>:                         self.this_item_weights[innerItemIndex] /= self.sumOfSquared_to_alpha[itemIndex] * self.sumOfSquared_to_1_minus_alpha[innerItemIndex]\</pre>
<pre class='cython code score-0 '>          __pyx_t_15 = __pyx_v_itemIndex;
          __pyx_t_16 = __pyx_v_innerItemIndex;
/* … */
          __pyx_t_17 = __pyx_v_innerItemIndex;
          *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_17 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) /= ((((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared_to_alpha.data + __pyx_t_15 * __pyx_v_self-&gt;sumOfSquared_to_alpha.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared_to_1_minus_alpha.data + __pyx_t_16 * __pyx_v_self-&gt;sumOfSquared_to_1_minus_alpha.strides[0]) )))) + __pyx_v_self-&gt;shrink) + 1e-6);
</pre><pre class="cython line score-0">&#xA0;<span class="">469</span>:                                                              + self.shrink + 1e-6</pre>
<pre class="cython line score-0">&#xA0;<span class="">470</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">471</span>:                     else:</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">472</span>:                         self.this_item_weights[innerItemIndex] /= self.sumOfSquared[itemIndex] * self.sumOfSquared[innerItemIndex]\</pre>
<pre class='cython code score-0 '>        /*else*/ {
          __pyx_t_18 = __pyx_v_itemIndex;
          __pyx_t_19 = __pyx_v_innerItemIndex;
/* … */
          __pyx_t_20 = __pyx_v_innerItemIndex;
          *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_20 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) /= ((((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_18 * __pyx_v_self-&gt;sumOfSquared.strides[0]) ))) * (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_19 * __pyx_v_self-&gt;sumOfSquared.strides[0]) )))) + __pyx_v_self-&gt;shrink) + 1e-6);
        }
        __pyx_L16:;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">473</span>:                                                              + self.shrink + 1e-6</pre>
<pre class="cython line score-0">&#xA0;<span class="">474</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">475</span>:             # Apply the specific denominator for Tanimoto</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">476</span>:             elif self.tanimoto_coefficient:</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = (__pyx_v_self-&gt;tanimoto_coefficient != 0);
    if (__pyx_t_10) {
/* … */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">477</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">478</span>:                     self.this_item_weights[innerItemIndex] /= self.sumOfSquared[itemIndex] + self.sumOfSquared[innerItemIndex] -\</pre>
<pre class='cython code score-0 '>        __pyx_t_21 = __pyx_v_itemIndex;
        __pyx_t_22 = __pyx_v_innerItemIndex;
/* … */
        __pyx_t_24 = __pyx_v_innerItemIndex;
        *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_24 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) /= (((((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_21 * __pyx_v_self-&gt;sumOfSquared.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_22 * __pyx_v_self-&gt;sumOfSquared.strides[0]) )))) - (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_23 * __pyx_v_self-&gt;this_item_weights.strides[0]) )))) + __pyx_v_self-&gt;shrink) + 1e-6);
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">479</span>:                                                          self.this_item_weights[innerItemIndex] + self.shrink + 1e-6</pre>
<pre class='cython code score-0 '>        __pyx_t_23 = __pyx_v_innerItemIndex;
</pre><pre class="cython line score-0">&#xA0;<span class="">480</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">481</span>:             elif self.dice_coefficient:</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = (__pyx_v_self-&gt;dice_coefficient != 0);
    if (__pyx_t_10) {
/* … */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">482</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">483</span>:                     self.this_item_weights[innerItemIndex] /= self.sumOfSquared[itemIndex] + self.sumOfSquared[innerItemIndex] +\</pre>
<pre class='cython code score-0 '>        __pyx_t_25 = __pyx_v_itemIndex;
        __pyx_t_26 = __pyx_v_innerItemIndex;
/* … */
        __pyx_t_27 = __pyx_v_innerItemIndex;
        *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_27 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) /= ((((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_25 * __pyx_v_self-&gt;sumOfSquared.strides[0]) ))) + (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_26 * __pyx_v_self-&gt;sumOfSquared.strides[0]) )))) + __pyx_v_self-&gt;shrink) + 1e-6);
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">484</span>:                                                          self.shrink + 1e-6</pre>
<pre class="cython line score-0">&#xA0;<span class="">485</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">486</span>:             elif self.tversky_coefficient:</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = (__pyx_v_self-&gt;tversky_coefficient != 0);
    if (__pyx_t_10) {
/* … */
      goto __pyx_L13;
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">487</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">488</span>:                     self.this_item_weights[innerItemIndex] /= self.this_item_weights[innerItemIndex] + \</pre>
<pre class='cython code score-0 '>        __pyx_t_28 = __pyx_v_innerItemIndex;
/* … */
        __pyx_t_33 = __pyx_v_innerItemIndex;
        *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_33 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) /= (((((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_28 * __pyx_v_self-&gt;this_item_weights.strides[0]) ))) + (((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_29 * __pyx_v_self-&gt;sumOfSquared.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_30 * __pyx_v_self-&gt;this_item_weights.strides[0]) )))) * __pyx_v_self-&gt;tversky_alpha)) + (((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;sumOfSquared.data + __pyx_t_31 * __pyx_v_self-&gt;sumOfSquared.strides[0]) ))) - (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_32 * __pyx_v_self-&gt;this_item_weights.strides[0]) )))) * __pyx_v_self-&gt;tversky_beta)) + __pyx_v_self-&gt;shrink) + 1e-6);
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">489</span>:                                                               (self.sumOfSquared[itemIndex]-self.this_item_weights[innerItemIndex])*self.tversky_alpha + \</pre>
<pre class='cython code score-0 '>        __pyx_t_29 = __pyx_v_itemIndex;
        __pyx_t_30 = __pyx_v_innerItemIndex;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">490</span>:                                                               (self.sumOfSquared[innerItemIndex]-self.this_item_weights[innerItemIndex])*self.tversky_beta +\</pre>
<pre class='cython code score-0 '>        __pyx_t_31 = __pyx_v_innerItemIndex;
        __pyx_t_32 = __pyx_v_innerItemIndex;
</pre><pre class="cython line score-0">&#xA0;<span class="">491</span>:                                                               self.shrink + 1e-6</pre>
<pre class="cython line score-0">&#xA0;<span class="">492</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">493</span>:             elif self.shrink != 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = ((__pyx_v_self-&gt;shrink != 0) != 0);
    if (__pyx_t_10) {
/* … */
    }
    __pyx_L13:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">494</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">495</span>:                     self.this_item_weights[innerItemIndex] /= self.shrink</pre>
<pre class='cython code score-0 '>        __pyx_t_34 = __pyx_v_innerItemIndex;
        *((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_34 * __pyx_v_self-&gt;this_item_weights.strides[0]) )) /= __pyx_v_self-&gt;shrink;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">496</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">497</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">498</span>:             if self.TopK == 0:</pre>
<pre class='cython code score-0 '>    __pyx_t_10 = ((__pyx_v_self-&gt;TopK == 0) != 0);
    if (__pyx_t_10) {
/* … */
      goto __pyx_L25;
    }
</pre><pre class="cython line score-0">&#xA0;<span class="">499</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">500</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">501</span>:                     self.W_dense[innerItemIndex,itemIndex] = self.this_item_weights[innerItemIndex]</pre>
<pre class='cython code score-0 '>        __pyx_t_35 = __pyx_v_innerItemIndex;
        __pyx_t_36 = __pyx_v_innerItemIndex;
        __pyx_t_37 = __pyx_v_itemIndex;
        *((double *) ( /* dim=1 */ (( /* dim=0 */ (__pyx_v_self-&gt;W_dense.data + __pyx_t_36 * __pyx_v_self-&gt;W_dense.strides[0]) ) + __pyx_t_37 * __pyx_v_self-&gt;W_dense.strides[1]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_35 * __pyx_v_self-&gt;this_item_weights.strides[0]) )));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">502</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">503</span>:             else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">504</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">505</span>:                 # Sort indices and select TopK</pre>
<pre class="cython line score-0">&#xA0;<span class="">506</span>:                 # Using numpy implies some overhead, unfortunately the plain C qsort function is even slower</pre>
<pre class="cython line score-0">&#xA0;<span class="">507</span>:                 #top_k_idx = np.argsort(this_item_weights) [-self.TopK:]</pre>
<pre class="cython line score-0">&#xA0;<span class="">508</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">509</span>:                 # Sorting is done in three steps. Faster then plain np.argsort for higher number of items</pre>
<pre class="cython line score-0">&#xA0;<span class="">510</span>:                 # because we avoid sorting elements we already know we don't care about</pre>
<pre class="cython line score-0">&#xA0;<span class="">511</span>:                 # - Partition the data to extract the set of TopK items, this set is unsorted</pre>
<pre class="cython line score-0">&#xA0;<span class="">512</span>:                 # - Sort only the TopK items, discarding the rest</pre>
<pre class="cython line score-0">&#xA0;<span class="">513</span>:                 # - Get the original item index</pre>
<pre class="cython line score-0">&#xA0;<span class="">514</span>:                 #</pre>
<pre class="cython line score-0">&#xA0;<span class="">515</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">516</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">517</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">518</span>:                 #this_item_weights_np = clone(template_zero, self.this_item_weights_counter, zero=False)</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">519</span>:                 for innerItemIndex in range(self.n_columns):</pre>
<pre class='cython code score-0 '>    /*else*/ {
      __pyx_t_9 = __pyx_v_self-&gt;n_columns;
      __pyx_t_14 = __pyx_t_9;
      for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_14; __pyx_t_13+=1) {
        __pyx_v_innerItemIndex = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">520</span>:                     this_item_weights_np[innerItemIndex] = 0.0</pre>
<pre class='cython code score-0 '>        __pyx_t_38 = __pyx_v_innerItemIndex;
        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer.buf, __pyx_t_38, __pyx_pybuffernd_this_item_weights_np.diminfo[0].strides) = 0.0;
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">521</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">522</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">523</span>:                 # Add weights in the same ordering as the self.this_item_weights_id data structure</pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">524</span>:                 for innerItemIndex in range(self.this_item_weights_counter):</pre>
<pre class='cython code score-0 '>      __pyx_t_13 = __pyx_v_self-&gt;this_item_weights_counter;
      __pyx_t_39 = __pyx_t_13;
      for (__pyx_t_40 = 0; __pyx_t_40 &lt; __pyx_t_39; __pyx_t_40+=1) {
        __pyx_v_innerItemIndex = __pyx_t_40;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">525</span>:                     item_id = self.this_item_weights_id[innerItemIndex]</pre>
<pre class='cython code score-0 '>        __pyx_t_41 = __pyx_v_innerItemIndex;
        __pyx_v_item_id = (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_id.data + __pyx_t_41 * __pyx_v_self-&gt;this_item_weights_id.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">526</span>:                     this_item_weights_np[innerItemIndex] = - self.this_item_weights[item_id]</pre>
<pre class='cython code score-0 '>        __pyx_t_42 = __pyx_v_item_id;
        __pyx_t_43 = __pyx_v_innerItemIndex;
        *__Pyx_BufPtrStrided1d(__pyx_t_5numpy_float64_t *, __pyx_pybuffernd_this_item_weights_np.rcbuffer-&gt;pybuffer.buf, __pyx_t_43, __pyx_pybuffernd_this_item_weights_np.diminfo[0].strides) = (-(*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_42 * __pyx_v_self-&gt;this_item_weights.strides[0]) ))));
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">527</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">528</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">529</span>:                 local_topK = min([self.TopK, self.this_item_weights_counter])</pre>
<pre class='cython code score-0 '>      __pyx_t_13 = __pyx_v_self-&gt;this_item_weights_counter;
      __pyx_t_39 = __pyx_v_self-&gt;TopK;
      if (((__pyx_t_13 &lt; __pyx_t_39) != 0)) {
        __pyx_t_40 = __pyx_t_13;
      } else {
        __pyx_t_40 = __pyx_t_39;
      }
      __pyx_v_local_topK = __pyx_t_40;
</pre><pre class="cython line score-0">&#xA0;<span class="">530</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">531</span>:                 # Get the unordered set of topK items</pre>
<pre class="cython line score-69" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">532</span>:                 top_k_partition = np.argpartition(this_item_weights_np, local_topK-1)[0:local_topK]</pre>
<pre class='cython code score-69 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_argpartition);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>((__pyx_v_local_topK - 1));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_1 = NULL;
      __pyx_t_40 = 0;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
        __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
        if (likely(__pyx_t_1)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
          __pyx_t_40 = 1;
        }
      }
      #if CYTHON_FAST_PYCALL
      if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
        PyObject *__pyx_temp[3] = {__pyx_t_1, ((PyObject *)__pyx_v_this_item_weights_np), __pyx_t_4};
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_40, 2+__pyx_t_40);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      #if CYTHON_FAST_PYCCALL
      if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
        PyObject *__pyx_temp[3] = {__pyx_t_1, ((PyObject *)__pyx_v_this_item_weights_np), __pyx_t_4};
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_40, 2+__pyx_t_40);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      } else
      #endif
      {
        __pyx_t_3 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_40);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        if (__pyx_t_1) {
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0, __pyx_t_1); __pyx_t_1 = NULL;
        }
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_v_this_item_weights_np));
        <span class='refnanny'>__Pyx_GIVEREF</span>(((PyObject *)__pyx_v_this_item_weights_np));
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 0+__pyx_t_40, ((PyObject *)__pyx_v_this_item_weights_np));
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_3, 1+__pyx_t_40, __pyx_t_4);
        __pyx_t_4 = 0;
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_3, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      }
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetSlice</span>(__pyx_t_5, 0, __pyx_v_local_topK, NULL, NULL, NULL, 1, 1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 532, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 532, __pyx_L1_error)</span>
      __pyx_t_44 = ((PyArrayObject *)__pyx_t_2);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer);
        __pyx_t_40 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_44, &amp;__Pyx_TypeInfo_PY_LONG_LONG, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_40 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_45, &amp;__pyx_t_46, &amp;__pyx_t_47);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_top_k_partition, &amp;__Pyx_TypeInfo_PY_LONG_LONG, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_45); Py_XDECREF(__pyx_t_46); Py_XDECREF(__pyx_t_47);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_45, __pyx_t_46, __pyx_t_47);
          }
          __pyx_t_45 = __pyx_t_46 = __pyx_t_47 = 0;
        }
        __pyx_pybuffernd_top_k_partition.diminfo[0].strides = __pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_top_k_partition.diminfo[0].shape = __pyx_pybuffernd_top_k_partition.rcbuffer-&gt;pybuffer.shape[0];
        if (unlikely(__pyx_t_40 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 532, __pyx_L1_error)</span>
      }
      __pyx_t_44 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_top_k_partition, ((PyArrayObject *)__pyx_t_2));
      __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">533</span>:                 # Sort only the elements in the partition</pre>
<pre class="cython line score-43" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">534</span>:                 top_k_partition_sorting = np.argsort(this_item_weights_np[top_k_partition])</pre>
<pre class='cython code score-43 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 534, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_argsort);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 534, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_this_item_weights_np), ((PyObject *)__pyx_v_top_k_partition));<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 534, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_4 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
        __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
        if (likely(__pyx_t_4)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
        }
      }
      __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 534, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 534, __pyx_L1_error)</span>
      __pyx_t_44 = ((PyArrayObject *)__pyx_t_2);
      {
        __Pyx_BufFmt_StackElem __pyx_stack[1];
        <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer);
        __pyx_t_40 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_44, &amp;__Pyx_TypeInfo_PY_LONG_LONG, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack);
        if (unlikely(__pyx_t_40 &lt; 0)) {
          <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_47, &amp;__pyx_t_46, &amp;__pyx_t_45);
          if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_top_k_partition_sorting, &amp;__Pyx_TypeInfo_PY_LONG_LONG, PyBUF_FORMAT| PyBUF_STRIDES, 1, 0, __pyx_stack) == -1)) {
            Py_XDECREF(__pyx_t_47); Py_XDECREF(__pyx_t_46); Py_XDECREF(__pyx_t_45);
            <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
          } else {
            <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_47, __pyx_t_46, __pyx_t_45);
          }
          __pyx_t_47 = __pyx_t_46 = __pyx_t_45 = 0;
        }
        __pyx_pybuffernd_top_k_partition_sorting.diminfo[0].strides = __pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_top_k_partition_sorting.diminfo[0].shape = __pyx_pybuffernd_top_k_partition_sorting.rcbuffer-&gt;pybuffer.shape[0];
        if (unlikely(__pyx_t_40 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 534, __pyx_L1_error)</span>
      }
      __pyx_t_44 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_top_k_partition_sorting, ((PyArrayObject *)__pyx_t_2));
      __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">535</span>:                 # Get original index</pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">536</span>:                 top_k_idx = top_k_partition[top_k_partition_sorting]</pre>
<pre class='cython code score-5 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_top_k_partition), ((PyObject *)__pyx_v_top_k_partition_sorting));<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_48 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_PY_LONG_LONG</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_48.memview)) __PYX_ERR(0, 536, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __PYX_XDEC_MEMVIEW(&amp;__pyx_v_top_k_idx, 1);
      __pyx_v_top_k_idx = __pyx_t_48;
      __pyx_t_48.memview = NULL;
      __pyx_t_48.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">537</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">538</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">539</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">540</span>:                 # Incrementally build sparse matrix, do not add zeros</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">541</span>:                 for innerItemIndex in range(len(top_k_idx)):</pre>
<pre class='cython code score-2 '>      __pyx_t_49 = <span class='pyx_c_api'>__Pyx_MemoryView_Len</span>(__pyx_v_top_k_idx); 
      __pyx_t_50 = __pyx_t_49;
      for (__pyx_t_40 = 0; __pyx_t_40 &lt; __pyx_t_50; __pyx_t_40+=1) {
        __pyx_v_innerItemIndex = __pyx_t_40;
</pre><pre class="cython line score-0">&#xA0;<span class="">542</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">543</span>:                     topKItemIndex = top_k_idx[innerItemIndex]</pre>
<pre class='cython code score-0 '>        __pyx_t_51 = __pyx_v_innerItemIndex;
        __pyx_v_topKItemIndex = (*((PY_LONG_LONG *) ( /* dim=0 */ (__pyx_v_top_k_idx.data + __pyx_t_51 * __pyx_v_top_k_idx.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">544</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">545</span>:                     item_id = self.this_item_weights_id[topKItemIndex]</pre>
<pre class='cython code score-0 '>        __pyx_t_52 = __pyx_v_topKItemIndex;
        __pyx_v_item_id = (*((int *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights_id.data + __pyx_t_52 * __pyx_v_self-&gt;this_item_weights_id.strides[0]) )));
</pre><pre class="cython line score-0">&#xA0;<span class="">546</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">547</span>:                     if self.this_item_weights[item_id] != 0.0:</pre>
<pre class='cython code score-0 '>        __pyx_t_53 = __pyx_v_item_id;
        __pyx_t_10 = (((*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_53 * __pyx_v_self-&gt;this_item_weights.strides[0]) ))) != 0.0) != 0);
        if (__pyx_t_10) {
/* … */
        }
      }
    }
    __pyx_L25:;
</pre><pre class="cython line score-0">&#xA0;<span class="">548</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">549</span>:                         values[sparse_data_pointer] = self.this_item_weights[item_id]</pre>
<pre class='cython code score-0 '>          __pyx_t_54 = __pyx_v_item_id;
          __pyx_t_55 = __pyx_v_sparse_data_pointer;
          *((double *) ( /* dim=0 */ (__pyx_v_values.data + __pyx_t_55 * __pyx_v_values.strides[0]) )) = (*((double *) ( /* dim=0 */ (__pyx_v_self-&gt;this_item_weights.data + __pyx_t_54 * __pyx_v_self-&gt;this_item_weights.strides[0]) )));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">550</span>:                         rows[sparse_data_pointer] = item_id</pre>
<pre class='cython code score-0 '>          __pyx_t_56 = __pyx_v_sparse_data_pointer;
          *((int *) ( /* dim=0 */ (__pyx_v_rows.data + __pyx_t_56 * __pyx_v_rows.strides[0]) )) = __pyx_v_item_id;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">551</span>:                         cols[sparse_data_pointer] = itemIndex</pre>
<pre class='cython code score-0 '>          __pyx_t_57 = __pyx_v_sparse_data_pointer;
          *((int *) ( /* dim=0 */ (__pyx_v_cols.data + __pyx_t_57 * __pyx_v_cols.strides[0]) )) = __pyx_v_itemIndex;
</pre><pre class="cython line score-0">&#xA0;<span class="">552</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">553</span>:                         sparse_data_pointer += 1</pre>
<pre class='cython code score-0 '>          __pyx_v_sparse_data_pointer = (__pyx_v_sparse_data_pointer + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">554</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">555</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">556</span>:             itemIndex += 1</pre>
<pre class='cython code score-0 '>    __pyx_v_itemIndex = (__pyx_v_itemIndex + 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">557</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">558</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">559</span>:             if processedItems % print_block_size==0 or processedItems==end_col_local:</pre>
<pre class='cython code score-0 '>    __pyx_t_11 = (((__pyx_v_processedItems % __pyx_v_print_block_size) == 0) != 0);
    if (!__pyx_t_11) {
    } else {
      __pyx_t_10 = __pyx_t_11;
      goto __pyx_L36_bool_binop_done;
    }
    __pyx_t_11 = ((__pyx_v_processedItems == __pyx_v_end_col_local) != 0);
    __pyx_t_10 = __pyx_t_11;
    __pyx_L36_bool_binop_done:;
    if (__pyx_t_10) {
/* … */
    }
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">560</span>: </pre>
<pre class="cython line score-22" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">561</span>:                 current_time = time.time()</pre>
<pre class='cython code score-22 '>      <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 561, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_3 = NULL;
      if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
        __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
        if (likely(__pyx_t_3)) {
          PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
          <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        }
      }
      __pyx_t_2 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 561, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_current_time, __pyx_t_2);
      __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">562</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">563</span>:                 # Set block size to the number of items necessary in order to print every 30 seconds</pre>
<pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">564</span>:                 if current_time - start_time != 0:</pre>
<pre class='cython code score-11 '>      __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_current_time, __pyx_v_start_time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 564, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_NeObjC</span>(__pyx_t_2, __pyx_int_0, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 564, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_5); if (unlikely(__pyx_t_10 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 564, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      if (__pyx_t_10) {
/* … */
        goto __pyx_L38;
      }
</pre><pre class="cython line score-12" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">565</span>:                     itemPerSec = processedItems/(current_time - start_time)</pre>
<pre class='cython code score-12 '>        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_processedItems);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 565, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_current_time, __pyx_v_start_time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 565, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_t_5, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 565, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_itemPerSec, __pyx_t_3);
        __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">566</span>:                 else:</pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">567</span>:                     itemPerSec = 1</pre>
<pre class='cython code score-2 '>      /*else*/ {
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_int_1);
        <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_itemPerSec, __pyx_int_1);
      }
      __pyx_L38:;
</pre><pre class="cython line score-0">&#xA0;<span class="">568</span>: </pre>
<pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">569</span>:                 print_block_size = int(itemPerSec*30)</pre>
<pre class='cython code score-16 '>      __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_v_itemPerSec, __pyx_int_30);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 569, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Int</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 569, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      __pyx_t_40 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_40 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 569, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_print_block_size = __pyx_t_40;
</pre><pre class="cython line score-0">&#xA0;<span class="">570</span>: </pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">571</span>:                 if current_time - last_print_time &gt; 30  or processedItems==end_col_local:</pre>
<pre class='cython code score-14 '>      __pyx_t_2 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_v_current_time, __pyx_v_last_print_time);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 571, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_3 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_t_2, __pyx_int_30, Py_GT); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 571, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_3); if (unlikely(__pyx_t_11 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 571, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
      if (!__pyx_t_11) {
      } else {
        __pyx_t_10 = __pyx_t_11;
        goto __pyx_L40_bool_binop_done;
      }
      __pyx_t_11 = ((__pyx_v_processedItems == __pyx_v_end_col_local) != 0);
      __pyx_t_10 = __pyx_t_11;
      __pyx_L40_bool_binop_done:;
      if (__pyx_t_10) {
/* … */
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">572</span>: </pre>
<pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">573</span>:                     print("Similarity column {} ( {:2.0f} % ), {:.2f} column/sec, elapsed time {:.2f} min".format(</pre>
<pre class='cython code score-6 '>        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_kp_u_Similarity_column_2_0f_2f_column, __pyx_n_s_format);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
/* … */
        __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-81" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">574</span>:                         processedItems, processedItems*1.0/(end_col_local-start_col_local)*100, itemPerSec, (time.time()-start_time) / 60))</pre>
<pre class='cython code score-81 '>        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_processedItems);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_4 = <span class='py_c_api'>PyFloat_FromDouble</span>((((__pyx_v_processedItems * 1.0) / ((double)(__pyx_v_end_col_local - __pyx_v_start_col_local))) * 100.0));<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_58, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
        __pyx_t_59 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_58, __pyx_n_s_time);<span class='error_goto'> if (unlikely(!__pyx_t_59)) __PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_59);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        __pyx_t_58 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_59))) {
          __pyx_t_58 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_59);
          if (likely(__pyx_t_58)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_59);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_58);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_59, function);
          }
        }
        __pyx_t_1 = (__pyx_t_58) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_59, __pyx_t_58) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_59);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_59); __pyx_t_59 = 0;
        __pyx_t_59 = <span class='py_c_api'>PyNumber_Subtract</span>(__pyx_t_1, __pyx_v_start_time);<span class='error_goto'> if (unlikely(!__pyx_t_59)) __PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_59);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_TrueDivideObjC</span>(__pyx_t_59, __pyx_int_60, 60, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 574, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_59); __pyx_t_59 = 0;
        __pyx_t_59 = NULL;
        __pyx_t_40 = 0;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
          __pyx_t_59 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
          if (likely(__pyx_t_59)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_59);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
            __pyx_t_40 = 1;
          }
        }
        #if CYTHON_FAST_PYCALL
        if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
          PyObject *__pyx_temp[5] = {__pyx_t_59, __pyx_t_5, __pyx_t_4, __pyx_v_itemPerSec, __pyx_t_1};
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_40, 4+__pyx_t_40);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_59); __pyx_t_59 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        } else
        #endif
        #if CYTHON_FAST_PYCCALL
        if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
          PyObject *__pyx_temp[5] = {__pyx_t_59, __pyx_t_5, __pyx_t_4, __pyx_v_itemPerSec, __pyx_t_1};
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_40, 4+__pyx_t_40);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
          <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_59); __pyx_t_59 = 0;
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
        } else
        #endif
        {
          __pyx_t_58 = <span class='py_c_api'>PyTuple_New</span>(4+__pyx_t_40);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
          if (__pyx_t_59) {
            <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_59); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_58, 0, __pyx_t_59); __pyx_t_59 = NULL;
          }
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_58, 0+__pyx_t_40, __pyx_t_5);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_58, 1+__pyx_t_40, __pyx_t_4);
          <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_itemPerSec);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_itemPerSec);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_58, 2+__pyx_t_40, __pyx_v_itemPerSec);
          <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
          <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_58, 3+__pyx_t_40, __pyx_t_1);
          __pyx_t_5 = 0;
          __pyx_t_4 = 0;
          __pyx_t_1 = 0;
          __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_58, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 573, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
          <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        }
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">575</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">576</span>:                     last_print_time = current_time</pre>
<pre class='cython code score-2 '>        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_current_time);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_last_print_time, __pyx_v_current_time);
</pre><pre class="cython line score-0">&#xA0;<span class="">577</span>: </pre>
<pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">578</span>:                     sys.stdout.flush()</pre>
<pre class='cython code score-25 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_sys);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 578, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_stdout);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 578, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_58, __pyx_n_s_flush);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 578, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        __pyx_t_58 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
          __pyx_t_58 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
          if (likely(__pyx_t_58)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_58);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
          }
        }
        __pyx_t_2 = (__pyx_t_58) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_58) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 578, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">579</span>:                     sys.stderr.flush()</pre>
<pre class='cython code score-25 '>        <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_sys);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 579, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_stderr);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 579, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_58, __pyx_n_s_flush);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 579, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        __pyx_t_58 = NULL;
        if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
          __pyx_t_58 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
          if (likely(__pyx_t_58)) {
            PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_58);
            <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
            <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
          }
        }
        __pyx_t_2 = (__pyx_t_58) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_58) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
        if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 579, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">580</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">581</span>:         # End while on columns</pre>
<pre class="cython line score-0">&#xA0;<span class="">582</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">583</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">584</span>:         if self.TopK == 0:</pre>
<pre class='cython code score-0 '>  __pyx_t_10 = ((__pyx_v_self-&gt;TopK == 0) != 0);
  if (__pyx_t_10) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">585</span>: </pre>
<pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">586</span>:             return np.array(self.W_dense)</pre>
<pre class='cython code score-21 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = __pyx_memoryview_fromslice(__pyx_v_self-&gt;W_dense, 2, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 586, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_58))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_58);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_58);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_58, function);
      }
    }
    __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_58, __pyx_t_1, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_58, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 586, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
    __pyx_r = __pyx_t_2;
    __pyx_t_2 = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">587</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">588</span>:         else:</pre>
<pre class="cython line score-0">&#xA0;<span class="">589</span>: </pre>
<pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">590</span>:             values = np.array(values[0:sparse_data_pointer])</pre>
<pre class='cython code score-23 '>  /*else*/ {
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_58, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 590, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_58, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 590, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
    __pyx_t_7.data = __pyx_v_values.data;
    __pyx_t_7.memview = __pyx_v_values.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_7, 0);
    __pyx_t_40 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_7,
    __pyx_v_values.shape[0], __pyx_v_values.strides[0], __pyx_v_values.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_40,
    0,
    __pyx_v_sparse_data_pointer,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 590, __pyx_L1_error)</span>
}

__pyx_t_58 = __pyx_memoryview_fromslice(__pyx_t_7, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 590, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_7, 1);
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_t_58) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_58);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 590, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_double</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_7.memview)) __PYX_ERR(0, 590, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_values, 1);
    __pyx_v_values = __pyx_t_7;
    __pyx_t_7.memview = NULL;
    __pyx_t_7.data = NULL;
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">591</span>:             rows = np.array(rows[0:sparse_data_pointer])</pre>
<pre class='cython code score-23 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 591, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8.data = __pyx_v_rows.data;
    __pyx_t_8.memview = __pyx_v_rows.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_8, 0);
    __pyx_t_40 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_8,
    __pyx_v_rows.shape[0], __pyx_v_rows.strides[0], __pyx_v_rows.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_40,
    0,
    __pyx_v_sparse_data_pointer,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 591, __pyx_L1_error)</span>
}

__pyx_t_3 = __pyx_memoryview_fromslice(__pyx_t_8, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 591, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
    __pyx_t_8.memview = NULL;
    __pyx_t_8.data = NULL;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_58))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_58);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_58);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_58, function);
      }
    }
    __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_58, __pyx_t_1, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_58, __pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 591, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 591, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_rows, 1);
    __pyx_v_rows = __pyx_t_8;
    __pyx_t_8.memview = NULL;
    __pyx_t_8.data = NULL;
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">592</span>:             cols = np.array(cols[0:sparse_data_pointer])</pre>
<pre class='cython code score-23 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_58, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_58, __pyx_n_s_array);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
    __pyx_t_8.data = __pyx_v_cols.data;
    __pyx_t_8.memview = __pyx_v_cols.memview;
    __PYX_INC_MEMVIEW(&amp;__pyx_t_8, 0);
    __pyx_t_40 = -1;
    if (unlikely(__pyx_memoryview_slice_memviewslice(
    &amp;__pyx_t_8,
    __pyx_v_cols.shape[0], __pyx_v_cols.strides[0], __pyx_v_cols.suboffsets[0],
    0,
    0,
    &amp;__pyx_t_40,
    0,
    __pyx_v_sparse_data_pointer,
    0,
    1,
    1,
    0,
    1) &lt; 0))
{
    <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L1_error)</span>
}

__pyx_t_58 = __pyx_memoryview_fromslice(__pyx_t_8, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    __PYX_XDEC_MEMVIEW(&amp;__pyx_t_8, 1);
    __pyx_t_8.memview = NULL;
    __pyx_t_8.data = NULL;
    __pyx_t_1 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
      __pyx_t_1 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
      if (likely(__pyx_t_1)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
      }
    }
    __pyx_t_2 = (__pyx_t_1) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_1, __pyx_t_58) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_t_58);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
    if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 592, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyObject_to_MemoryviewSlice_ds_int</span>(__pyx_t_2, PyBUF_WRITABLE);<span class='error_goto'> if (unlikely(!__pyx_t_8.memview)) __PYX_ERR(0, 592, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __PYX_XDEC_MEMVIEW(&amp;__pyx_v_cols, 1);
    __pyx_v_cols = __pyx_t_8;
    __pyx_t_8.memview = NULL;
    __pyx_t_8.data = NULL;
</pre><pre class="cython line score-0">&#xA0;<span class="">593</span>: </pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">594</span>:             W_sparse = sps.csr_matrix((values, (rows, cols)),</pre>
<pre class='cython code score-30 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_sps);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_csr_matrix);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    __pyx_t_2 = __pyx_memoryview_fromslice(__pyx_v_values, 1, (PyObject *(*)(char *)) __pyx_memview_get_double, (int (*)(char *, PyObject *)) __pyx_memview_set_double, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_58 = __pyx_memoryview_fromslice(__pyx_v_rows, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    __pyx_t_1 = __pyx_memoryview_fromslice(__pyx_v_cols, 1, (PyObject *(*)(char *)) __pyx_memview_get_int, (int (*)(char *, PyObject *)) __pyx_memview_set_int, 0);;<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_58);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_58);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 1, __pyx_t_1);
    __pyx_t_58 = 0;
    __pyx_t_1 = 0;
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_4);
    __pyx_t_2 = 0;
    __pyx_t_4 = 0;
    __pyx_t_4 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_4, 0, __pyx_t_1);
    __pyx_t_1 = 0;
/* … */
    __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_3, __pyx_t_4, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 594, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_W_sparse = __pyx_t_58;
    __pyx_t_58 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">595</span>:                                     shape=(self.n_columns, self.n_columns),</pre>
<pre class='cython code score-19 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_self-&gt;n_columns);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 595, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_58);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_58);
    __pyx_t_2 = 0;
    __pyx_t_58 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_shape, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 595, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-11" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">596</span>:                                     dtype=np.float32)</pre>
<pre class='cython code score-11 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_5, __pyx_n_s_np);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 596, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_58 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_5, __pyx_n_s_float32);<span class='error_goto'> if (unlikely(!__pyx_t_58)) __PYX_ERR(0, 596, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_58);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_1, __pyx_n_s_dtype, __pyx_t_58) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 595, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_58); __pyx_t_58 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">597</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">598</span>:             return W_sparse</pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_W_sparse);
    __pyx_r = __pyx_v_W_sparse;
    goto __pyx_L0;
  }
</pre></div></body></html>
